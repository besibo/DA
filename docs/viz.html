<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Travaux Pratiques de Biométrie 2</title>
  <meta name="description" content="Ce livre est un document permettant de prendre en main les logiciels R et RStudio afin de réaliser des représentations graphiques et des statistiques descriptives simples dans le cadre des travaux pratiques de Biométrie 2.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Travaux Pratiques de Biométrie 2" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://besibo.github.io/Biometrie2/" />
  
  <meta property="og:description" content="Ce livre est un document permettant de prendre en main les logiciels R et RStudio afin de réaliser des représentations graphiques et des statistiques descriptives simples dans le cadre des travaux pratiques de Biométrie 2." />
  <meta name="github-repo" content="besibo/Biometrie2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Travaux Pratiques de Biométrie 2" />
  
  <meta name="twitter:description" content="Ce livre est un document permettant de prendre en main les logiciels R et RStudio afin de réaliser des représentations graphiques et des statistiques descriptives simples dans le cadre des travaux pratiques de Biométrie 2." />
  

<meta name="author" content="Benoît Simon-Bouhet">


<meta name="date" content="2018-10-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="dataset.html">
<link rel="next" href="tidyr.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TP de Biométrie 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objectifs"><i class="fa fa-check"></i><b>1.1</b> Objectifs</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#organisation"><i class="fa fa-check"></i><b>1.2</b> Organisation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="bases.html"><a href="bases.html"><i class="fa fa-check"></i><b>2</b> R et RStudio : les bases</a><ul>
<li class="chapter" data-level="2.1" data-path="bases.html"><a href="bases.html#que-sont-r-et-rstudio"><i class="fa fa-check"></i><b>2.1</b> Que sont R et RStudio</a><ul>
<li class="chapter" data-level="2.1.1" data-path="bases.html"><a href="bases.html#installation-de-r-et-rstudio"><i class="fa fa-check"></i><b>2.1.1</b> Installation de R et RStudio</a></li>
<li class="chapter" data-level="2.1.2" data-path="bases.html"><a href="bases.html#utiliser-r-depuis-rstudio"><i class="fa fa-check"></i><b>2.1.2</b> Utiliser R depuis RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="bases.html"><a href="bases.html#code"><i class="fa fa-check"></i><b>2.2</b> Comment exécuter du code R ?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="bases.html"><a href="bases.html#la-console"><i class="fa fa-check"></i><b>2.2.1</b> La console</a></li>
<li class="chapter" data-level="2.2.2" data-path="bases.html"><a href="bases.html#le-repertoire-de-travail"><i class="fa fa-check"></i><b>2.2.2</b> Le répertoire de travail</a></li>
<li class="chapter" data-level="2.2.3" data-path="bases.html"><a href="bases.html#les-scripts"><i class="fa fa-check"></i><b>2.2.3</b> Les scripts</a></li>
<li class="chapter" data-level="2.2.4" data-path="bases.html"><a href="bases.html#concepts-de-base-en-programmation-et-terminologie"><i class="fa fa-check"></i><b>2.2.4</b> Concepts de base en programmation et terminologie</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="bases.html"><a href="bases.html#packages"><i class="fa fa-check"></i><b>2.3</b> Les packages additionels</a><ul>
<li class="chapter" data-level="2.3.1" data-path="bases.html"><a href="bases.html#installation-dun-package"><i class="fa fa-check"></i><b>2.3.1</b> Installation d’un package</a></li>
<li class="chapter" data-level="2.3.2" data-path="bases.html"><a href="bases.html#charger-un-package-en-memoire"><i class="fa fa-check"></i><b>2.3.2</b> Charger un package en mémoire</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="bases.html"><a href="bases.html#exercices"><i class="fa fa-check"></i><b>2.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dataset.html"><a href="dataset.html"><i class="fa fa-check"></i><b>3</b> Explorez votre premier jeu de données</a><ul>
<li class="chapter" data-level="3.1" data-path="dataset.html"><a href="dataset.html#le-package-nycflights13"><i class="fa fa-check"></i><b>3.1</b> Le package <code>nycflights13</code></a></li>
<li class="chapter" data-level="3.2" data-path="dataset.html"><a href="dataset.html#le-data-frame-flights"><i class="fa fa-check"></i><b>3.2</b> Le data frame <code>flights</code></a></li>
<li class="chapter" data-level="3.3" data-path="dataset.html"><a href="dataset.html#explorer-un-data.frame"><i class="fa fa-check"></i><b>3.3</b> Explorer un <code>data.frame</code></a><ul>
<li class="chapter" data-level="3.3.1" data-path="dataset.html"><a href="dataset.html#View"><i class="fa fa-check"></i><b>3.3.1</b> <code>View()</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="dataset.html"><a href="dataset.html#glimpse"><i class="fa fa-check"></i><b>3.3.2</b> <code>glimpse()</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="dataset.html"><a href="dataset.html#loperateur"><i class="fa fa-check"></i><b>3.3.3</b> L’opérateur <code>$</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="dataset.html"><a href="dataset.html#les-fichiers-daide"><i class="fa fa-check"></i><b>3.3.4</b> Les fichiers d’aide</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="dataset.html"><a href="dataset.html#exercices-1"><i class="fa fa-check"></i><b>3.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>4</b> Visualiser des données avec <code>ggplot2</code></a><ul>
<li class="chapter" data-level="4.1" data-path="viz.html"><a href="viz.html#prerequis"><i class="fa fa-check"></i><b>4.1</b> Prérequis</a></li>
<li class="chapter" data-level="4.2" data-path="viz.html"><a href="viz.html#gggraph"><i class="fa fa-check"></i><b>4.2</b> La grammaire des graphiques</a><ul>
<li class="chapter" data-level="4.2.1" data-path="viz.html"><a href="viz.html#elements-de-la-grammaire"><i class="fa fa-check"></i><b>4.2.1</b> Éléments de la grammaire</a></li>
<li class="chapter" data-level="4.2.2" data-path="viz.html"><a href="viz.html#gapminder"><i class="fa fa-check"></i><b>4.2.2</b> Gapminder</a></li>
<li class="chapter" data-level="4.2.3" data-path="viz.html"><a href="viz.html#autres-elements-de-la-grammaire-des-graphiques"><i class="fa fa-check"></i><b>4.2.3</b> Autres éléments de la grammaire des graphiques</a></li>
<li class="chapter" data-level="4.2.4" data-path="viz.html"><a href="viz.html#le-package-ggplot2"><i class="fa fa-check"></i><b>4.2.4</b> Le package <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="viz.html"><a href="viz.html#clouds"><i class="fa fa-check"></i><b>4.3</b> Les nuages de points</a><ul>
<li class="chapter" data-level="4.3.1" data-path="viz.html"><a href="viz.html#la-couche-de-base-la-fonction-ggplot"><i class="fa fa-check"></i><b>4.3.1</b> La couche de base : la fonction <code>ggplot()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="viz.html"><a href="viz.html#ajout-dune-couche-supplementaire-lobjet-geometrique"><i class="fa fa-check"></i><b>4.3.2</b> Ajout d’une couche supplémentaire : l’objet géométrique</a></li>
<li class="chapter" data-level="4.3.3" data-path="viz.html"><a href="viz.html#exercices-2"><i class="fa fa-check"></i><b>4.3.3</b> Exercices</a></li>
<li class="chapter" data-level="4.3.4" data-path="viz.html"><a href="viz.html#over-plotting"><i class="fa fa-check"></i><b>4.3.4</b> Over-plotting</a></li>
<li class="chapter" data-level="4.3.5" data-path="viz.html"><a href="viz.html#couleur-taille-et-forme"><i class="fa fa-check"></i><b>4.3.5</b> Couleur, taille et forme</a></li>
<li class="chapter" data-level="4.3.6" data-path="viz.html"><a href="viz.html#exercices-3"><i class="fa fa-check"></i><b>4.3.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="viz.html"><a href="viz.html#les-graphiques-en-lignes"><i class="fa fa-check"></i><b>4.4</b> Les graphiques en lignes</a><ul>
<li class="chapter" data-level="4.4.1" data-path="viz.html"><a href="viz.html#un-nouveau-jeu-de-donnees"><i class="fa fa-check"></i><b>4.4.1</b> Un nouveau jeu de données</a></li>
<li class="chapter" data-level="4.4.2" data-path="viz.html"><a href="viz.html#exercice"><i class="fa fa-check"></i><b>4.4.2</b> Exercice</a></li>
<li class="chapter" data-level="4.4.3" data-path="viz.html"><a href="viz.html#la-fonction-geom_line"><i class="fa fa-check"></i><b>4.4.3</b> La fonction <code>geom_line()</code></a></li>
<li class="chapter" data-level="4.4.4" data-path="viz.html"><a href="viz.html#a-quel-endroit-placer-aes-et-les-arguments-color-size-etc."><i class="fa fa-check"></i><b>4.4.4</b> À quel endroit placer <code>aes()</code> et les arguments <code>color</code>, <code>size</code>, etc. ?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="viz.html"><a href="viz.html#histogram"><i class="fa fa-check"></i><b>4.5</b> Les histogrammes</a><ul>
<li class="chapter" data-level="4.5.1" data-path="viz.html"><a href="viz.html#lobjet-geom_histogram"><i class="fa fa-check"></i><b>4.5.1</b> L’objet <code>geom_histogram()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="viz.html"><a href="viz.html#la-taille-des-classes"><i class="fa fa-check"></i><b>4.5.2</b> La taille des classes</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="viz.html"><a href="viz.html#facets"><i class="fa fa-check"></i><b>4.6</b> Les <code>facet</code>s</a><ul>
<li class="chapter" data-level="4.6.1" data-path="viz.html"><a href="viz.html#facet_wrap"><i class="fa fa-check"></i><b>4.6.1</b> <code>facet_wrap()</code></a></li>
<li class="chapter" data-level="4.6.2" data-path="viz.html"><a href="viz.html#facet_grid"><i class="fa fa-check"></i><b>4.6.2</b> <code>facet_grid()</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="viz.html"><a href="viz.html#exercices-4"><i class="fa fa-check"></i><b>4.6.3</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="viz.html"><a href="viz.html#les-boites-a-moustaches-ou-boxplots"><i class="fa fa-check"></i><b>4.7</b> Les boîtes à moustaches ou boxplots</a><ul>
<li class="chapter" data-level="4.7.1" data-path="viz.html"><a href="viz.html#creation-de-boxplots-et-informations-apportees"><i class="fa fa-check"></i><b>4.7.1</b> Création de boxplots et informations apportées</a></li>
<li class="chapter" data-level="4.7.2" data-path="viz.html"><a href="viz.html#lintervalle-de-confiance-a-95-de-la-mediane"><i class="fa fa-check"></i><b>4.7.2</b> L’intervalle de confiance à 95% de la médiane</a></li>
<li class="chapter" data-level="4.7.3" data-path="viz.html"><a href="viz.html#une-autre-facon-dexaminer-des-distributions"><i class="fa fa-check"></i><b>4.7.3</b> Une autre façon d’examiner des distributions</a></li>
<li class="chapter" data-level="4.7.4" data-path="viz.html"><a href="viz.html#pour-conclure"><i class="fa fa-check"></i><b>4.7.4</b> Pour conclure</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="viz.html"><a href="viz.html#les-diagrammes-batons"><i class="fa fa-check"></i><b>4.8</b> Les diagrammes bâtons</a><ul>
<li class="chapter" data-level="4.8.1" data-path="viz.html"><a href="viz.html#representation-graphique-avec-geom_bar-et-geom_col"><i class="fa fa-check"></i><b>4.8.1</b> Représentation graphique avec <code>geom_bar</code> et <code>geom_col</code></a></li>
<li class="chapter" data-level="4.8.2" data-path="viz.html"><a href="viz.html#un-example-concret"><i class="fa fa-check"></i><b>4.8.2</b> Un example concret</a></li>
<li class="chapter" data-level="4.8.3" data-path="viz.html"><a href="viz.html#exercices-5"><i class="fa fa-check"></i><b>4.8.3</b> Exercices</a></li>
<li class="chapter" data-level="4.8.4" data-path="viz.html"><a href="viz.html#eviter-a-tout-prix-les-diagrammes-circulaires"><i class="fa fa-check"></i><b>4.8.4</b> Éviter à tout prix les diagrammes circulaires</a></li>
<li class="chapter" data-level="4.8.5" data-path="viz.html"><a href="viz.html#comparer-2-variables-categorielles-avec-un-diagramme-baton"><i class="fa fa-check"></i><b>4.8.5</b> Comparer 2 variables catégorielles avec un diagramme bâton</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="viz.html"><a href="viz.html#de-lexploration-a-lexposition"><i class="fa fa-check"></i><b>4.9</b> De l’exploration à l’exposition</a><ul>
<li class="chapter" data-level="4.9.1" data-path="viz.html"><a href="viz.html#les-labels"><i class="fa fa-check"></i><b>4.9.1</b> Les labels</a></li>
<li class="chapter" data-level="4.9.2" data-path="viz.html"><a href="viz.html#les-echelles"><i class="fa fa-check"></i><b>4.9.2</b> Les échelles</a></li>
<li class="chapter" data-level="4.9.3" data-path="viz.html"><a href="viz.html#les-themes"><i class="fa fa-check"></i><b>4.9.3</b> Les thèmes</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="viz.html"><a href="viz.html#exercices-6"><i class="fa fa-check"></i><b>4.10</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>5</b> (Ar)ranger des données avec <code>tidyr</code></a><ul>
<li class="chapter" data-level="5.1" data-path="tidyr.html"><a href="tidyr.html#prerek"><i class="fa fa-check"></i><b>5.1</b> Prérequis</a></li>
<li class="chapter" data-level="5.2" data-path="tidyr.html"><a href="tidyr.html#cest-quoi-des-tidy-data"><i class="fa fa-check"></i><b>5.2</b> C’est quoi des “tidy data” ?</a><ul>
<li class="chapter" data-level="5.2.1" data-path="tidyr.html"><a href="tidyr.html#la-fonction-gather"><i class="fa fa-check"></i><b>5.2.1</b> La fonction <code>gather()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="tidyr.html"><a href="tidyr.html#spread"><i class="fa fa-check"></i><b>5.2.2</b> La fonction <code>spread()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="tidyr.html"><a href="tidyr.html#les-fonctions-separate-et-unite"><i class="fa fa-check"></i><b>5.2.3</b> Les fonctions <code>separate()</code> et <code>unite()</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="tidyr.html"><a href="tidyr.html#exercices-7"><i class="fa fa-check"></i><b>5.2.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="tidyr.html"><a href="tidyr.html#importer-des-donnees-depuis-un-tableur"><i class="fa fa-check"></i><b>5.3</b> Importer des données depuis un tableur</a><ul>
<li class="chapter" data-level="5.3.1" data-path="tidyr.html"><a href="tidyr.html#les-regles-de-base"><i class="fa fa-check"></i><b>5.3.1</b> Les règles de base</a></li>
<li class="chapter" data-level="5.3.2" data-path="tidyr.html"><a href="tidyr.html#tableur"><i class="fa fa-check"></i><b>5.3.2</b> Fichiers au format tableur (.xls ou .xlsx)</a></li>
<li class="chapter" data-level="5.3.3" data-path="tidyr.html"><a href="tidyr.html#fichiers-au-format-texte-brut-.csv"><i class="fa fa-check"></i><b>5.3.3</b> Fichiers au format texte brut (.csv)</a></li>
<li class="chapter" data-level="5.3.4" data-path="tidyr.html"><a href="tidyr.html#exercices-8"><i class="fa fa-check"></i><b>5.3.4</b> Exercices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>6</b> Tripatouiller les données avec <code>dplyr</code></a><ul>
<li class="chapter" data-level="6.1" data-path="wrangling.html"><a href="wrangling.html#pre-requis"><i class="fa fa-check"></i><b>6.1</b> Pré-requis</a></li>
<li class="chapter" data-level="6.2" data-path="wrangling.html"><a href="wrangling.html#le-pipe"><i class="fa fa-check"></i><b>6.2</b> Le pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="6.3" data-path="wrangling.html"><a href="wrangling.html#les-verbes-du-tripatouillage-de-donnees"><i class="fa fa-check"></i><b>6.3</b> Les verbes du tripatouillage de données</a></li>
<li class="chapter" data-level="6.4" data-path="wrangling.html"><a href="wrangling.html#filtrer-des-lignes-avec-filter"><i class="fa fa-check"></i><b>6.4</b> Filtrer des lignes avec <code>filter()</code></a><ul>
<li class="chapter" data-level="6.4.1" data-path="wrangling.html"><a href="wrangling.html#principe"><i class="fa fa-check"></i><b>6.4.1</b> Principe</a></li>
<li class="chapter" data-level="6.4.2" data-path="wrangling.html"><a href="wrangling.html#exercice-1"><i class="fa fa-check"></i><b>6.4.2</b> Exercice</a></li>
<li class="chapter" data-level="6.4.3" data-path="wrangling.html"><a href="wrangling.html#les-conditions-logiques"><i class="fa fa-check"></i><b>6.4.3</b> Les conditions logiques</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="wrangling.html"><a href="wrangling.html#creer-des-resumes-avec-summarise-et-group_by"><i class="fa fa-check"></i><b>6.5</b> Créer des résumés avec <code>summarise()</code> et <code>group_by()</code></a><ul>
<li class="chapter" data-level="6.5.1" data-path="wrangling.html"><a href="wrangling.html#principe-de-la-fonction-summarise"><i class="fa fa-check"></i><b>6.5.1</b> Principe de la fonction <code>summarise()</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="wrangling.html"><a href="wrangling.html#interet-de-la-fonction-group_by"><i class="fa fa-check"></i><b>6.5.2</b> Intérêt de la fonction <code>group_by()</code></a></li>
<li class="chapter" data-level="6.5.3" data-path="wrangling.html"><a href="wrangling.html#ajouter-des-barres-derreurs-sur-un-graphique"><i class="fa fa-check"></i><b>6.5.3</b> Ajouter des barres d’erreurs sur un graphique</a></li>
<li class="chapter" data-level="6.5.4" data-path="wrangling.html"><a href="wrangling.html#grouper-par-plus-dune-variable"><i class="fa fa-check"></i><b>6.5.4</b> Grouper par plus d’une variable</a></li>
<li class="chapter" data-level="6.5.5" data-path="wrangling.html"><a href="wrangling.html#un-raccourci-pratique-pour-compter-des-effectifs"><i class="fa fa-check"></i><b>6.5.5</b> Un raccourci pratique pour compter des effectifs</a></li>
<li class="chapter" data-level="6.5.6" data-path="wrangling.html"><a href="wrangling.html#exercices-9"><i class="fa fa-check"></i><b>6.5.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="wrangling.html"><a href="wrangling.html#selectionner-des-variables-avec-select"><i class="fa fa-check"></i><b>6.6</b> Sélectionner des variables avec <code>select()</code></a></li>
<li class="chapter" data-level="6.7" data-path="wrangling.html"><a href="wrangling.html#creer-de-nouvelles-variables-avec-mutate"><i class="fa fa-check"></i><b>6.7</b> Créer de nouvelles variables avec <code>mutate()</code></a><ul>
<li class="chapter" data-level="6.7.1" data-path="wrangling.html"><a href="wrangling.html#principe-1"><i class="fa fa-check"></i><b>6.7.1</b> Principe</a></li>
<li class="chapter" data-level="6.7.2" data-path="wrangling.html"><a href="wrangling.html#exercices-10"><i class="fa fa-check"></i><b>6.7.2</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="wrangling.html"><a href="wrangling.html#arrange"><i class="fa fa-check"></i><b>6.8</b> Trier des lignes avec <code>arrange()</code></a></li>
<li class="chapter" data-level="6.9" data-path="wrangling.html"><a href="wrangling.html#associer-plusieurs-tableaux-avec-left_join-et-inner_join"><i class="fa fa-check"></i><b>6.9</b> Associer plusieurs tableaux avec <code>left_join()</code> et <code>inner_join()</code></a><ul>
<li class="chapter" data-level="6.9.1" data-path="wrangling.html"><a href="wrangling.html#principe-2"><i class="fa fa-check"></i><b>6.9.1</b> Principe</a></li>
<li class="chapter" data-level="6.9.2" data-path="wrangling.html"><a href="wrangling.html#inner_join"><i class="fa fa-check"></i><b>6.9.2</b> <code>inner_join()</code></a></li>
<li class="chapter" data-level="6.9.3" data-path="wrangling.html"><a href="wrangling.html#left_join"><i class="fa fa-check"></i><b>6.9.3</b> <code>left_join()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="wrangling.html"><a href="wrangling.html#exercices-11"><i class="fa fa-check"></i><b>6.10</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>Références</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publié avec bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Travaux Pratiques de Biométrie 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="viz" class="section level1">
<h1><span class="header-section-number">4</span> Visualiser des données avec <code>ggplot2</code></h1>
<p>Dans les chapitres <a href="bases.html#bases">2</a> et <a href="dataset.html#dataset">3</a>, nous avons vu ce qui me semble être les concepts essentiels avant de commencer à explorer en détail des données dans R. Les éléments de syntaxe abordés dans la section <a href="bases.html#code">2.2</a> sont nombreux et vous n’avez probablement pas tout retenu. C’est pourquoi je vous conseille de garder les tutoriels de DataCamp à portée de main afin de pouvoir refaire les parties que vous maîtrisez le moins. Ce n’est qu’en répétant plusieurs fois ces tutoriels que les choses seront vraiment comprises et que vous les retiendrez. Ainsi, si des éléments de code présentés ci-dessous vous semblent obscurs, revenez en arrière : toutes les réponses à vos questions se trouvent probablement dans les chapitres précédents.</p>
<p>Après la découverte des bases du langage R, nous abordons maintenant les parties de ce livre qui concernent la “science des données” (ou “Data Science” pour nos amis anglo-saxons). Nous allons voir dans ce chapitre qu’outre les fonctions <code>View()</code> et <code>glimpse()</code>, l’exploration visuelle <em>via</em> la représentation graphique des données est un moyen indispensable et très puissant pour comprendre ce qui se passe dans un jeu de données. <strong>La visualisation de vos données devrait toujours être un préambule à toute analyse statistique.</strong></p>
<p>La visualisation des données est en outre un excellent point de départ quand on découvre la programmation sous R, car ses bénéfices sont clairs et immédiats : vous pouvez créer des graphiques élégants et informatifs qui vous aident à comprendre les données. Dans ce chapitre, vous allez donc plonger dans l’art de la visualisation des données, en apprenant la structure de base des graphiques réalisés avec <code>ggplot2</code> qui permettent de transformer des données numériques et catégorielles en graphiques.</p>
<p>Toutefois, la visualisation seule ne suffit généralement pas. Il est en effet souvent nécessaire de transformer les données pour produire des représentations plus parlantes. Ainsi, dans les chapitres <a href="tidyr.html#tidyr">5</a> et <a href="wrangling.html#wrangling">6</a>, vous découvrirez les verbes clés qui vous permettront de sélectionner des variables importantes, de filtrer les observations clés, de créer de nouvelles variables, de calculer des résumés, d’associer des tableaux ou de les remettre en forme.</p>
<p>Ce n’est qu’en combinant les transformations de données et représentations graphiques d’une part, avec votre curiosité et votre esprit critique d’autre part, que vous serez véritablement en mesure de réaliser une analyse exploratoire utile de vos données. C’est la seule façon d’identifier des questions intéressantes et pertinentes sur vos données, afin de tenter d’y répondre par les analyses statistiques et la modélisation par la suite.</p>
<hr />
<div id="prerequis" class="section level2">
<h2><span class="header-section-number">4.1</span> Prérequis</h2>
<p>Dans ce chapitre, nous aurons besoin des packages suivants :</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<p>Si ce n’est pas déjà fait, pensez à les installer avant de les charger en mémoire.</p>
<p>Au niveau le plus élémentaire, les graphiques permettent de comprendre comment les variables se comparent en termes de tendance centrale (à quel endroit les valeurs ont tendance à être localisées, regroupées) et leur dispersion (comment les données varient autour du centre). La chose la plus importante à savoir sur les graphiques est qu’ils doivent être créés pour que votre public (le professeur qui vous évalue, le collègue avec qui vous collaborez, votre futur employeur, etc.) comprenne bien les résultats et les informations que vous souhaitez transmettre. Il s’agit d’un exercice d’équilibriste : d’une part, vous voulez mettre en évidence autant de relations significatives et de résultats intéressants que possible, mais de l’autre, vous ne voulez pas trop en inclure, afin d’éviter de rendre votre graphique illisible ou de submerger votre public. Tout comme n’importe quel paragraphe de document écrit, un graphique doit permettre de <strong>communiquer un message</strong> (une idée forte, un résultat marquant, une hypothèse nouvelle, etc).</p>
<p>Comme nous le verrons, les graphiques nous aident également à repérer les tendances extrêmes et les valeurs aberrantes dans nos données. Nous verrons aussi qu’une façon de faire, assez classique, consiste à comparer la distribution d’une variable quantitative pour les différents niveaux d’une variable catégorielle.</p>
<hr />
</div>
<div id="gggraph" class="section level2">
<h2><span class="header-section-number">4.2</span> La grammaire des graphiques</h2>
<p>Les lettres <code>gg</code> du package <code>ggplot</code> sont l’abbréviation de “grammar of graphics” : la grammaire des graphiques. De la même manière que nous construisons des phrases en respectant des règles grammaticales précises (usage des noms, des verbes, des sujets et adjectifs…), la grammaire des graphiques établit un certain nombre de règles permettant de construire des graphiques : elle précise les composants d’un graphique en suivant le cadre théorique défini par <span class="citation">Wilkinson (<a href="#ref-wilkinson2005">2005</a>)</span>.</p>
<div id="elements-de-la-grammaire" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Éléments de la grammaire</h3>
<p>En bref, la grammaire des graphiques nous dit que :</p>
<blockquote>
<p>Un graphique est l’association (<code>mapping</code>) de données/variables (<code>data</code>) à des attributs esthétiques (<code>aes</code>thetics) d’objets géométriques (<code>geom</code>etric objects).</p>
</blockquote>
<p>Pour clarifier, on peut disséquer un graphique en 3 éléments essentiels :</p>
<ol style="list-style-type: decimal">
<li><code>data</code> : le jeu de données contenant les variables que l’on va associer à des objets géométriques</li>
<li><code>geom</code> : les objets géométriques en question. Cela fait référence aux types d’objets que l’on peut observer sur le graphiques (des points, des lignes, des barres, etc)</li>
<li><code>aes</code> : les attributs esthétiques des objets géométriques présents sur le graphique. Par exemple, la position sur les axes <code>x</code> et <code>y</code>, la couleur, la taille, la transparence, la forme, etc. Chacun de ces attributs esthétiques peut-être associé à une variable de notre jeu de données.</li>
</ol>
<p>Examinons un exemple pour bien comprendre.</p>
</div>
<div id="gapminder" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Gapminder</h3>
<p>En février 2006, un statisticien du nom de Hans Rosling a donné un TED Talk intitulé “<a href="https://www.ted.com/talks/hans_rosling_shows_the_best_stats_you_ve_ever_seen">The best stats you’we ever seen</a>”. Au cours de cette conférence, Hans Rosling présente des données sur l’économie mondiale, la santé et le développement des pays du monde. Les données sont disponibles <a href="https://www.gapminder.org/tools/#$chart-type=bubbles">sur ce site</a> et dans <a href="https://cran.r-project.org/web/packages/gapminder/index.html">le package <code>gapminder</code></a>.</p>
<p>Pour l’année 2007, le jeu de données contient des informations pour 142 pays. Examinons les premières lignes de ce jeu de données :</p>
<table>
<caption><span id="tab:unnamed-chunk-35">Table 4.1: </span>Les 6 premières lignes du jeu de données <code>gapminder</code> pour l’année 2007</caption>
<thead>
<tr class="header">
<th align="left">Country</th>
<th align="left">Continent</th>
<th align="right">Life Expectancy</th>
<th align="right">Population</th>
<th align="right">GDP per Capita</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="left">Asia</td>
<td align="right">43.828</td>
<td align="right">31889923</td>
<td align="right">974.5803</td>
</tr>
<tr class="even">
<td align="left">Albania</td>
<td align="left">Europe</td>
<td align="right">76.423</td>
<td align="right">3600523</td>
<td align="right">5937.0295</td>
</tr>
<tr class="odd">
<td align="left">Algeria</td>
<td align="left">Africa</td>
<td align="right">72.301</td>
<td align="right">33333216</td>
<td align="right">6223.3675</td>
</tr>
<tr class="even">
<td align="left">Angola</td>
<td align="left">Africa</td>
<td align="right">42.731</td>
<td align="right">12420476</td>
<td align="right">4797.2313</td>
</tr>
<tr class="odd">
<td align="left">Argentina</td>
<td align="left">Americas</td>
<td align="right">75.320</td>
<td align="right">40301927</td>
<td align="right">12779.3796</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="left">Oceania</td>
<td align="right">81.235</td>
<td align="right">20434176</td>
<td align="right">34435.3674</td>
</tr>
</tbody>
</table>
<p>Pour chaque ligne, les variables suivantes sont décrites :</p>
<ul>
<li><code>Country</code> : le pays</li>
<li><code>Continent</code> : le continent</li>
<li><code>Life Expectancy</code> : espérance de vie à la naissance</li>
<li><code>Population</code> : nombre de personnes vivant dans le pays</li>
<li><code>GDP per Capita</code> : produit intérieur brut (PIB) par habitant en dollars américains. GDP est l’abréviation de “Growth Domestic Product”. C’est un indicateur de l’activité économique d’un pays, parfois utilisé comme une approximation du revenu moyen par habitant.</li>
</ul>
<p>Examinons maintenant la figure <a href="viz.html#fig:gapmind">4.1</a> qui représente ces variables pour chacun des 142 pays de ce jeu de données (notez l’utilisation de la notation scientifique dans la légende).</p>
<div class="figure" style="text-align: center"><span id="fig:gapmind"></span>
<img src="figure/gapmind-1.png" alt="Espérance de vie en fonction du PIB par habitant en 2007" width="90%" />
<p class="caption">
Figure 4.1: Espérance de vie en fonction du PIB par habitant en 2007
</p>
</div>
<p>Si on décrypte ce graphique du point de vue de la grammaire des graphiques, on voit que :</p>
<ul>
<li>la variable <code>GDP per Capita</code> est associée à l’<code>aes</code>thetic <code>x</code> de la position des points</li>
<li>la variable <code>Life Expectancy</code> est associée à l’<code>aes</code>thetic <code>y</code> de la position des points</li>
<li>la variable <code>Population</code> est associée à l’<code>aes</code>thetic <code>size</code> (taille) des points</li>
<li>la variable <code>Continent</code> est associée à l’<code>aes</code>thetic <code>color</code> (couleur) des points</li>
</ul>
<p>Ici, l’objet géométrique (ou <code>geom</code>) qui représente les données est le point. Les données (ou <code>data</code>) sont contenues dans le tableau <code>gapminder</code> et chacune de ces variables est associée (<code>mapping</code>) aux caractéristiques esthétiques des points.</p>
</div>
<div id="autres-elements-de-la-grammaire-des-graphiques" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Autres éléments de la grammaire des graphiques</h3>
<p>Outre les éléments indispensables évoqués ici (<code>data</code>, <code>mapping</code>, <code>aes</code>, et <code>geom</code>), il existe d’autres aspects de la grammaire des graphiques qui permettent de contrôler l’aspect des graphiques. Ils ne sont pas toujours indispensables. Nous en verrons néanmoins quelque-uns particulièrement utiles :</p>
<ul>
<li><code>facet</code> : c’est un moyen très pratique de scinder le jeu de données en plusieurs sous-groupes et de produire automatiquement un graphique pour chacun d’entre eux.</li>
<li><code>position</code> : permet notamment de modifier la position des barres d’un barplot.</li>
<li><code>labs</code> : permet de définir les titres, sous-titres et légendes des axes d’un graphique</li>
<li><code>theme</code> : permet de modifier l’apect général des graphiques en appliquant des thèmes prédéfinis ou en modifiant certains aspects de thèmes existants</li>
</ul>
</div>
<div id="le-package-ggplot2" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Le package <code>ggplot2</code></h3>
<p>Comme indiqué plus haut, le package <code>ggplot2</code> <span class="citation">(Wickham et al. <a href="#ref-R-ggplot2">2018</a>)</span> permet de réaliser des graphiques dans R en respectant les principes de la grammaire des graphiques. Vous avez probablement remarqué que depuis le début de la section <a href="viz.html#gggraph">4.2</a>, beaucoup de termes sont écrits dans la police réservée au <code>code</code> informatique. C’est parce que les éléments de la grammaire des graphiques sont tous précisés dans la fonction <code>ggplot()</code> qui demande, au grand minimum, que les éléments suivants soient spécifiés :</p>
<ul>
<li>le nom du <code>data.frame</code> contenant les variables qui seront utilisées pour le graphique. Ce nom correspond à l’argument <code>data</code> de la fonction <code>ggplot()</code>.</li>
<li>l’association des variables à des attributs esthétiques. Cela se fait grâce à l’argument <code>mapping</code> et la fonction <code>aes()</code></li>
</ul>
<p>Après avoir spécifié ces éléments, on ajoute des couches supplémentaires au graphique grâce au signe <code>+</code>. La couche la plus essentielle à ajouter à un graphique, est une couche contenant un élément géométrique, ou <code>geom</code> (par exemple des points, des lignes ou des barres). D’autres couches peuvent s’ajouter pour spécifier des titres, des <code>facet</code>s ou des modifications des axes et des thèmes du graphique.</p>
<p>Dans le cadre de ce cours, nous nous limiterons aux 5 types de graphiques suivants :</p>
<ol style="list-style-type: decimal">
<li>les nuages de points</li>
<li>les graphiques en lignes</li>
<li>les boîtes à moustaches ou boxplots</li>
<li>les histogrammes</li>
<li>les diagrammes bâtons</li>
</ol>
<hr />
</div>
</div>
<div id="clouds" class="section level2">
<h2><span class="header-section-number">4.3</span> Les nuages de points</h2>
<p>C’est probablement le plus simple des 5 types de graphiques cités plus haut. Il s’agit de graphiques bi-variés pour lesquels une variable est associée à l’axe des abscisses, et une autre est associée à l’axe des ordonnées. Comme pour le graphique présenté à la figure <a href="viz.html#fig:gapmind">4.1</a> ci-dessus, d’autres variables peuvent être associées à des caractéristiques esthétiques des points (transparence, taille, couleur, forme…).</p>
<p>Nous allons ici nous intéresser à la relation qui existe entre :</p>
<ol style="list-style-type: decimal">
<li><code>dep_delay</code> : le retard des vols au décollage, que nous placerons sur l’axe des “x”</li>
<li><code>arr_delay</code> : le retard des mêmes vols à l’aterrissage, que nous placerons sur l’axe des “y”</li>
</ol>
<p>Afin d’avoir un jeu de données plus facile à utiliser, nous nous contenterons de visualiser les vols d’Alaska Airlines, donc le code de compagnie aérienne est <code>&quot;AS&quot;</code>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">alaska_flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(carrier <span class="op">==</span><span class="st"> &quot;AS&quot;</span>)</a></code></pre></div>
<p>Il est normal que vous ne compreniez pas encore les commandes ci-dessus : elles seront décrites dans le chapitre <a href="wrangling.html#wrangling">6</a>. Retenez juste que nous avons créé un nouveau tableau, nommé <code>alaska_flights</code>, qui contient toutes les informations des vols d’Alaska Airlines. Commencez par examiner ce tableau avec la fonction <code>View()</code>. En quoi est-il différent du tableau <code>flights</code> ?</p>
<div id="la-couche-de-base-la-fonction-ggplot" class="section level3">
<h3><span class="header-section-number">4.3.1</span> La couche de base : la fonction <code>ggplot()</code></h3>
<p>La fonction <code>ggplot()</code> permet d’établir la première base du graphique. C’est grâce à cette fonction que l’on précise quel jeu de données utiliser et quelle variables placer sur les axes :</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-37"></span>
<img src="figure/unnamed-chunk-37-1.png" alt="Un graphique sans `geom`" width="90%" />
<p class="caption">
Figure 4.2: Un graphique sans <code>geom</code>
</p>
</div>
<p>Ce graphique est pour le moins vide : c’est normal, nous n’avons pas encore spécifié la couche contenant l’objet géométrique que nous souhaitons utiliser.</p>
</div>
<div id="ajout-dune-couche-supplementaire-lobjet-geometrique" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Ajout d’une couche supplémentaire : l’objet géométrique</h3>
<p>Les nuages de points sont créés par la fonction <code>geom_point()</code> :</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<pre><code>Warning: Removed 5 rows containing missing values (geom_point).</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-38"></span>
<img src="figure/unnamed-chunk-38-1.png" alt="Retards à l'arrivée en fonction des retard au décollage pour les vols d'Alaska Airline au départ de New York City en 2013" width="90%" />
<p class="caption">
Figure 4.3: Retards à l’arrivée en fonction des retard au décollage pour les vols d’Alaska Airline au départ de New York City en 2013
</p>
</div>
<p>Plusieurs choses importantes sont à remarquer ici :</p>
<ol style="list-style-type: decimal">
<li>le graphique présente maintenant une couche supplémentaire constituée de points.</li>
<li>la fonction <code>geom_point()</code> nous prévient que 5 lignes contenant des données manquantes n’ont pas été intégrées au graphique. Les données manquent soit pour une variable, soit pour l’autre, soit pour les 2. Il est donc impossible de les faire apparaître sur le graphique.</li>
<li>il existe une relation positive entre <code>dep_delay</code> et <code>arr_delay</code> : quand le retard d’un vol au décollage augmente, le retard de ce vol augmente aussi à l’arrivée.</li>
<li>Enfin, il y a une grande majorité de points centrés près de l’origine (0,0).</li>
</ol>
<p>Si je résume cette syntaxe :</p>
<ul>
<li>Au sein de la fonction <code>ggplot()</code>, on spécifie 2 composants de la grammaire des graphiques :
<ol style="list-style-type: decimal">
<li>le nom du tableau contenant les données grâce à l’argument <code>data = alaska_flights</code></li>
<li>l’association (<code>mapping</code>) des variables à des caractéristiques esthétiques (<code>aes()</code>) en précisant <code>aes(x = dep_delay, y = arr_delay)</code> :
<ul>
<li>la variable <code>dep_delay</code> est associée à l’esthétique de position <code>x</code></li>
<li>la variable <code>arr_delay</code> est associée à l’esthétique de position <code>y</code></li>
</ul></li>
</ol></li>
<li>On ajoute une couche au graphique <code>ggplot()</code> grâce au symbole <code>+</code>. La couche en question précise le troisème élément indispensable de la grammaire des graphiques : l’objet <code>geom</code>étrique. Ici, les objets sont des <code>point</code>s. On le spécifie grâce à la fonction <code>geom_point()</code>.</li>
</ul>
<p>Quelques remarques concernant les couches :</p>
<ul>
<li>Notez que le signe <code>+</code> est placé <em>à la fin de la ligne</em>. Vous recevrez un message d’erreur si vous le placez au début.</li>
<li>Quand vous ajoutez une couche à un graphique, je vous encourage vivement à presser la touche <code>enter</code> de votre clavier juste après le symbole <code>+</code>. Ainsi, le code correspondant à chaque couche sera sur une ligne distincte, ce qui augmente considérablement la lisibilité de votre code.</li>
<li>Comme indiqué dans la section <a href="bases.html#functions">2.2.4.3</a>, tant que les arguments d’une fonction sont spécifiés dans l’ordre, on peut se passer d’écrire leur nom. Ainsi, les deux blocs de commande suivants produisent exactement le même résultat :</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co"># Le nom des arguments est précisé</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb78-4" data-line-number="4"></a>
<a class="sourceLine" id="cb78-5" data-line-number="5"><span class="co"># Le nom des arguments est omis</span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6"><span class="kw">ggplot</span>(alaska_flights, <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
</div>
<div id="exercices-2" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Exercices</h3>
<ol style="list-style-type: decimal">
<li>Donnez une raison pratique expliquant pourquoi les variables <code>dep_delay</code> et <code>arr_delay</code> ont une relation positive</li>
<li>Quelles variables (pas nécessairement dans le tableau <code>alaska_flights</code>) pourraient avoir une corrélation négative (relation négative) avec <code>dep_delay</code> ? Pourquoi ? Rappelez-vous que nous étudions ici des variables numériques.</li>
<li>Selon vous, pourquoi tant de points sont-il regroupés près de (0, 0) ? À quoi le point (0,0) correspond-il pour les vols d’Alaska Airline ?</li>
<li>Citez les éléments de ce graphique/de ces données qui vous sautent le plus aux yeux ?</li>
<li>Créez un nouveau nuage de points en utilisant d’autres variables du jeu de données <code>alaska_flights</code></li>
</ol>
</div>
<div id="over-plotting" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Over-plotting</h3>
<p>L’over-plotting est la superposition importante d’une grande quantité d’information sur une zone restreinte d’un graphique. Dans notre cas, nous observons un over-plotting important autour de (0,0). Cet effet est gênant car il est difficile de se faire une idée précise du nombre de points accumulés dans cette zone. La façon la plus simple de régler le problème est de modifier la transparence grâce à l’argument <code>alpha</code> de la fonction <code>geom_point()</code>. Par défaut, cette valeur est fixée à 1, pour une opacité totale. Une valeur de 0 rend les points totalement transparents, et donc invisibles. Trouver la bonne valeur peut demander de tâtonner une peu :</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-40"></span>
<img src="figure/unnamed-chunk-40-1.png" alt="La même figure, avec des points semi-transparents" width="90%" />
<p class="caption">
Figure 4.4: La même figure, avec des points semi-transparents
</p>
</div>
<p>Notez que :</p>
<ul>
<li>la transparence est additive : plus il y a de points, plus la zone est foncée car les points se superposent et rendent la zone plus opaque.</li>
<li>l’argument <code>alpha = 0.2</code> n’est pas intégré à l’intérieur d’une fonction <code>aes()</code> car il n’est pas associé à une variable : c’est un simple paramètre.</li>
</ul>
<p>L’over-plotting est souvent rencontré lorsque l’on représente plusieurs nuages de points pour les différentes valeurs d’une variable catégorielle. par exemple, si on transforme les mois de l’année en facteur (<code>factor(month)</code>), ont peut regarder s’il existe une relation entre les retards à l’aterrissage et le mois de l’année :</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-41"></span>
<img src="figure/unnamed-chunk-41-1.png" alt="Retards à l'arrivée pour les 12 mois de l'année 2013" width="90%" />
<p class="caption">
Figure 4.5: Retards à l’arrivée pour les 12 mois de l’année 2013
</p>
</div>
<p>Ici, l’ajout de transparence ne serait pas suffisant. Une autre solution est d’appliquer la mothode dîte de “jittering”, ou tremblement. Elle consiste à ajouter un bruit aléatoire horizontal et/ou vertical aux points d’un graphique. Ici, on peut ajouter un léger bruit horizontal afin de disperser un peu les points pour chaque mois de l’année. On n’ajoute pas de bruit vertical car on ne souhaite pas que les valeurs de retard (sur l’axe des <code>y</code>) soient altérées :</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.25</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:jittering"></span>
<img src="figure/jittering-1.png" alt="Retards à l'arrivée pour les 12 mois de l'année 2013" width="90%" />
<p class="caption">
Figure 4.6: Retards à l’arrivée pour les 12 mois de l’année 2013
</p>
</div>
<p>On y voit déjà plus clair. L’argument <code>width</code> permet de spécifier l’intensité de la dispersion horizontale. Pour ajouter du bruit vertical (ce qui n’est pas souhaitable ici !), on peut ajouter l’argument <code>height</code>. le graphique de la figure <a href="viz.html#fig:jittering">4.6</a> est parfois appelé un “stripchart”. C’est un graphique du type “nuage de points”, mais pour lequel l’une des 2 variables et numérique, et l’autre est catégorielle.</p>
<p>Il est évidemment possible d’ajouter de la transparence :</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.25</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-42"></span>
<img src="figure/unnamed-chunk-42-1.png" alt="Retards à l'arrivée pour les 12 mois de l'année 2013" width="90%" />
<p class="caption">
Figure 4.7: Retards à l’arrivée pour les 12 mois de l’année 2013
</p>
</div>
</div>
<div id="couleur-taille-et-forme" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Couleur, taille et forme</h3>
<p>L’argument <code>color</code> (ou <code>colour</code>, les deux orthographes fonctionnent) permet de spécifier la couleur des points. L’argument <code>size</code> permet de spécifier la taille des points. L’argument <code>shape</code> permet de spécifier la forme utilisée en guise de symbole. Ces 3 arguments peuvent être utilisés comme des paramètres, pour modifier l’ensemble des points d’un graphique. Mais ils peuvent aussi être associés à une variable, pour apporter une information supplémentaire.</p>
<p>Comparez les deux graphiques suivants :</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:rightcolor"></span>
<img src="figure/rightcolor-1.png" alt="Utilisation correcte de `color`" width="90%" />
<p class="caption">
Figure 4.8: Utilisation correcte de <code>color</code>
</p>
</div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wrongcolor"></span>
<img src="figure/wrongcolor-1.png" alt="Utilisation incorrecte de `color`" width="90%" />
<p class="caption">
Figure 4.9: Utilisation incorrecte de <code>color</code>
</p>
</div>
<p>Le code qui permet de produire la figure <a href="viz.html#fig:rightcolor">4.8</a> fait un usage correct de l’argument <code>color</code>. On demande des points de couleur bleue, les points apparaîssent bleus. La figure <a href="viz.html#fig:wrongcolor">4.9</a> en revanche ne produit pas le résultat attendu. Puisque nous avons mis l’argument <code>color</code> à l’intérieur de la fonction <code>aes()</code>, R s’attend à ce que la couleur soit associée à une variable. Puisqu’aucune variable ne s’appelle “blue”, R utilise la couleur par défaut. Pour associer la couleur des points à une variable, nous devons fournir un nom de variable valide :</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> <span class="kw">factor</span>(month)))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolor"></span>
<img src="figure/varcolor-1.png" alt="Association de `color` à une variable catégorielle" width="90%" />
<p class="caption">
Figure 4.10: Association de <code>color</code> à une variable catégorielle
</p>
</div>
<p>Ici, l’utilisation de la couleur est correcte. Elle est associée à une variable catégorielle, et chaque valeur possible du vecteur <code>month</code> se voit donc attribuer une couleur différente.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> arr_time))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolor2"></span>
<img src="figure/varcolor2-1.png" alt="Association de `color` à une variable numérique" width="90%" />
<p class="caption">
Figure 4.11: Association de <code>color</code> à une variable numérique
</p>
</div>
<p>De la même façon, la couleur des points est ici associée à une variable continue (l’heure d’arrivée des vols). Les points se voient donc attribuer une couleur choisie le long d’un gradient.</p>
<p>La même approche peut être utilisée pour spécifier la forme des symboles avec l’argument <code>shape</code>. Attention toutefois : une variable continue ne peut pas être associée à <code>shape</code></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape =</span> <span class="kw">factor</span>(month)))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shapeplot"></span>
<img src="figure/shapeplot-1.png" alt="Association de `shape` à un facteur" width="90%" />
<p class="caption">
Figure 4.12: Association de <code>shape</code> à un facteur
</p>
</div>
<p>Vous noterez que seuls les 6 premiers niveaux d’un facteur se voient attribuer une forme automatiquement. Au delà de 6 symboles différents sur un même graphique, le résultat est souvent illisible. Il est possible d’ajouter plus de 6 symboles, mais cela demande de modifier la légende manuellement et concrètement nous n’en aurons jamais besoin. Lorsque plus de 6 séries doivent être distinguées, d’autres solutions bien plus pertinentes (par exemple les <code>factet</code>s) devraient être utilisées.</p>
<p>Comme pour la couleur, il est possible d’e spécifier’utiliser l’argument <code>shape</code> en tant que paramètre du graphique sans l’associer à une variable. Il faut alors fournir un code compris entre 0 et 24 :</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">4</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shapeplot2"></span>
<img src="figure/shapeplot2-1.png" alt="Utilisation de `shape` en tant que paramètre" width="90%" />
<p class="caption">
Figure 4.13: Utilisation de <code>shape</code> en tant que paramètre
</p>
</div>
<p>Notez qu’ici, <code>ggplot()</code> ne crée pas de légende : tous les points ont le même symbole, ce symbole n’est pas associé à une variable, une légende est donc inutile.</p>
<p>Parmis les valeur possibles pour <code>shape</code>, les symboles 21 à 24 sont des symboles dont on peut spécifier séparément la couleur du contour, avec <code>color</code> et la couleur du fond avec <code>fill</code> :</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:shapecolorplot"></span>
<img src="figure/shapecolorplot-1.png" alt="Utilisation de `shape`, `color` et `fill`" width="90%" />
<p class="caption">
Figure 4.14: Utilisation de <code>shape</code>, <code>color</code> et <code>fill</code>
</p>
</div>
<p>N’hésitez pas à zoomer pour bien observer les points et comprendre ce qui se passe. Un conseil, faites des choix raisonnables ! Trop de couleurs n’est pas forcément souhaitable.</p>
<p>Enfin, on peut ajuster la taille des symboles avec l’argument <code>size</code>. Tout comme il n’est pas possible d’associer une variable continue à <code>shape</code>, et il n’est pas conseillé d’associer une variable catégorielle nominale (c’est à dire un facteur non ordonné) à <code>size</code>. Associer une variable continue est en ravanche parfois utile :</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> arr_time), <span class="dt">alpha =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:sizeplot"></span>
<img src="figure/sizeplot-1.png" alt="Association d'une variable continue à la taille des symboles avec l'argument `size`" width="90%" />
<p class="caption">
Figure 4.15: Association d’une variable continue à la taille des symboles avec l’argument <code>size</code>
</p>
</div>
<p>Si l’over-plotting est ici très important (c’est pourquoi j’ai utilisé <code>alpha</code>), on constate néanmoins que les vols avec les retards les plus importants sont presque tous arrivés très tôt dans la journée (“500” signifie 5h00 du matin). Il s’agit probablement de vols qui devaient arriver dans la nuit, avant minuit, et qui sont finalement arrivés en tout début de journée, etnre 00h01 et 5h00 du matin. Comme pour les autres arguments, il est possible d’utiliser <code>size</code> avec une valeur fixe, la même pour tous les symboles, lorsque cet argument n’est pas associé à une variable.</p>
<p>Enfin un conseil : évitez de trop surcharger vos graphiques. En combinant l’ensemble de ces arguments, il est malheureusement très facile d’obtenir des graphiques peu lisibles, ou contenant tellement d’information qu’ils en deviennent difficiles à déchiffrer. Faites preuve de modération :</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay, <span class="dt">size =</span> arr_time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.6</span>, </a>
<a class="sourceLine" id="cb91-3" data-line-number="3">             <span class="dt">shape =</span> <span class="dv">22</span>,</a>
<a class="sourceLine" id="cb91-4" data-line-number="4">             <span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>,</a>
<a class="sourceLine" id="cb91-5" data-line-number="5">             <span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>,</a>
<a class="sourceLine" id="cb91-6" data-line-number="6">             <span class="dt">stroke =</span> <span class="dv">2</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:badplot"></span>
<img src="figure/badplot-1.png" alt="Sometimes, less is more!" width="90%" />
<p class="caption">
Figure 4.16: Sometimes, less is more!
</p>
</div>
</div>
<div id="exercices-3" class="section level3">
<h3><span class="header-section-number">4.3.6</span> Exercices</h3>
<p>À quoi sert l’argument <code>stroke</code> ?</p>
<p>Avec le jeu de données <code>diamonds</code>, tapez les commandes suivantes pour créer un nouveau tableau <code>diams</code> contenant moins de lignes (5000 au lieu de près de 54000) :</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">4532</span>) <span class="co"># Afin que tout le monde récupère les mêmes lignes</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3">diams &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">5000</span>)</a></code></pre></div>
<p>Avec ce nouveau tableau <code>diams</code>, tapez le code permettant de créer le graphique <a href="viz.html#fig:exodiamonds">4.17</a> (Indice : affichez le tableau <code>diams</code> dans la console afin de voir quelles sont les variables disponibles).</p>
<div class="figure" style="text-align: center"><span id="fig:exodiamonds"></span>
<img src="figure/exodiamonds-1.png" alt="Prix de 5000 diamants en fonction de leur taille en carats et de leur couleur." width="90%" />
<p class="caption">
Figure 4.17: Prix de 5000 diamants en fonction de leur taille en carats et de leur couleur.
</p>
</div>
<p>Selon vous, à quoi sont dues les bandes verticales que l’on observe sur ce graphique ?</p>
<hr />
</div>
</div>
<div id="les-graphiques-en-lignes" class="section level2">
<h2><span class="header-section-number">4.4</span> Les graphiques en lignes</h2>
<div id="un-nouveau-jeu-de-donnees" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Un nouveau jeu de données</h3>
<p>Les graphiques en ligne, ou “linegraphs” sont généralement utilisés lorsque l’axe des <code>x</code> porte une information <strong>temporelle</strong>, et l’axe des <code>y</code> une autre variable numérique. Le temps est une variable naturellement ordonnée : les jours, semaines, mois, années, se suivent naturellement. Les graphiques en lignes devraient être évités lorsqu’il n’y a pas une organisation séquentielle évidente de la variable portée par l’axe des <code>x</code>.</p>
<p>Concentrons nous maintenant sur le tableau <code>weather</code> du package <code>nycflights13</code>. Explorez ce tableau en appliquant les méthodes vues dans le chapitre <a href="dataset.html#dataset">3</a>. N’oubliez pas de consultez l’aide de ce jeu de données.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">weather</a></code></pre></div>
<pre><code># A tibble: 26,115 x 15
   origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
 1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 
 2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06
 3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 
 4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 
 5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 
 6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 
 7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 
 8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 
 9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 
10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 
# ... with 26,105 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
#   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Nous allons nous intéresser à la variable <code>temp</code>, qui contient un enregistrement de température pour chaque heure de chaque jour de 2013 pour les 3 aéroports de New York. Cela représente une grande quantité de données, aussi, nous nous limiterons aux températures observées entre le 1er et le 15 janvier, pour l’aéroport Newark uniquement.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">small_weather &lt;-<span class="st"> </span>weather <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(origin <span class="op">==</span><span class="st"> &quot;EWR&quot;</span>,</a>
<a class="sourceLine" id="cb95-3" data-line-number="3">         month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb95-4" data-line-number="4">         day <span class="op">&lt;=</span><span class="st"> </span><span class="dv">15</span>)</a></code></pre></div>
<p>La fonction <code>filter()</code> fonctionne sur le même principe que la fonction <code>subset()</code> vue lors du premier TP. Ici, nous demandons à R de créer un nouveau tableau de données, nommé <code>small_weather</code>, qui ne contiendra que les lignes correspondant à <code>origin == &quot;EWR&quot;</code>, et <code>month == 1</code>, et <code>day &lt;= 15</code>, c’est à dire les données météorologiques de l’aéroport de Newark pour les 15 premiers jours de janvier 2013.</p>
</div>
<div id="exercice" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Exercice</h3>
<p>Avec <code>View()</code>, consultez le tableau nouvellement créé. Expliquez pourquoi la variable <code>time_hour</code> identifie de manière unique le moment ou chaque mesure a été réalisée alors que ce n’est pas le cas de la variable <code>hour</code>.</p>
</div>
<div id="la-fonction-geom_line" class="section level3">
<h3><span class="header-section-number">4.4.3</span> La fonction <code>geom_line()</code></h3>
<p>Les line graphs sont produits de la même façon que les nuages de points. Seul l’objet géométrique permettant de visualiser les données change. Au lieu d’utiliser <code>geom_point()</code>, on utilisera <code>geom_line()</code> :</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> small_weather, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:linegraph"></span>
<img src="figure/linegraph-1.png" alt="Températures horaires à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.18: Températures horaires à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Très logiquement, on observe des oscillations plus ou moins régulières qui correspondent à l’alternance jour/nuit. Notez l’échelle de l’axe des ordonnées : les températures sont enregistrées en degrés Farenheit.</p>
<p>Nous connaissons maintenant 2 types d’objets <code>geom</code>étriques : les points les les lignes. il est tout à fait possible d’ajouter plusieurs couches à un graphique, chacune d’elle correspondant à un objet <code>geom</code>étrique différent :</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> small_weather, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:lineplotgraph"></span>
<img src="figure/lineplotgraph-1.png" alt="Températures horaires à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.19: Températures horaires à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Enfin, comme pour les points, il est possible de spécifier plusieurs caractéristiques esthétiques des lignes, soit en les associant à des variables, au sein de la fonction <code>aes()</code>, soit en les utilisant en guise de paramètres pour modifier l’aspect général. Les arguments les plus classiques sont une fois de plus <code>color</code> (ou <code>colour</code>) pour modifier la couleur des lignes, <code>linetype</code> pour modifier le type de lignes (continues, pointillées, tirets, etc), et <code>size</code> pour modifier l’épaisseur des lignes.</p>
<p>Reprenons le jeu de données complet <code>weather</code>, et filtrons uniquement les dates comprises entre le premier et le 15 janvier, mais cette fois pour les 3 aéroports de New York :</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">small_weather_airports &lt;-<span class="st"> </span>weather <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">         day <span class="op">&lt;=</span><span class="st"> </span><span class="dv">15</span>)</a></code></pre></div>
<p>Nous pouvons maintenant réaliser un “linegraph” sur lequel une courbe apparaîtra pour chaque aéroport. Pour cela, nous devons associer la variable <code>origin</code> à un attribut esthétique des lignes. Par exemple :</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> small_weather_airports, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> origin))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:linecolor"></span>
<img src="figure/linecolor-1.png" alt="Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.20: Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Ou bien :</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> small_weather_airports, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype =</span> origin))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:linetype"></span>
<img src="figure/linetype-1.png" alt="Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.21: Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Ou encore :</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> small_weather_airports, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> origin, <span class="dt">linetype =</span> origin))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:linetypecolor"></span>
<img src="figure/linetypecolor-1.png" alt="Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.22: Températures horaires des 3 aéroports de New York entre le 1er et le 15 janvier 2013
</p>
</div>
</div>
<div id="a-quel-endroit-placer-aes-et-les-arguments-color-size-etc." class="section level3">
<h3><span class="header-section-number">4.4.4</span> À quel endroit placer <code>aes()</code> et les arguments <code>color</code>, <code>size</code>, etc. ?</h3>
<p>Jusqu’à maintenant, pour spécifier les associations entre certaines variables et les caractéristiques esthétiques d’un graphique, nous avons été amenés à utiliser la fonction <code>aes()</code> à 2 endroits distincts :</p>
<ol style="list-style-type: decimal">
<li>au sein de la fonction <code>ggplot()</code></li>
<li>au sein des fonctions <code>geom_XXX()</code></li>
</ol>
<p>Comment choisir l’endroit où renseigner <code>aes()</code> ? Pour bien comprendre, reprenons l’exemple du graphique <a href="viz.html#fig:lineplotgraph">4.19</a> sur lequel nous avions ajouté 2 couches contenant chacune un objet géométrique différent (afin de gagner de la place, j’omets volontairement le nom des arguments <code>data</code> et <code>mapping</code> dans la fonction <code>ggplot()</code>) :</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">ggplot</span>(small_weather, <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:lineplotgraph2"></span>
<img src="figure/lineplotgraph2-1.png" alt="Températures horaires à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.23: Températures horaires à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Voyons ce qui se passe si on associe la variable <code>wind_speed</code> à l’esthétique <code>color</code>, à plusieurs endroits du code ci-dessus. Comparez les trois syntaxes et observez les différences entre les 3 graphiques obtenus :</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">ggplot</span>(small_weather, <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp, <span class="dt">color =</span> wind_speed)) <span class="op">+</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb103-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wind"></span>
<img src="figure/wind-1.png" alt="Températures horaires et vitesse du vent à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.24: Températures horaires et vitesse du vent à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">ggplot</span>(small_weather, <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> wind_speed)) <span class="op">+</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wind2"></span>
<img src="figure/wind2-1.png" alt="Températures horaires et vitesse du vent à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.25: Températures horaires et vitesse du vent à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">ggplot</span>(small_weather, <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> wind_speed))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wind3"></span>
<img src="figure/wind3-1.png" alt="Températures horaires et vitesse du vent à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.26: Températures horaires et vitesse du vent à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<p>Vous l’aurez compris, lorsque l’on spécifie <code>aes()</code> à l’intérieur de la fonction <code>ggplot()</code>, les associations de variables et d’esthétiques sont appliquées à tous les objets géométriques, donc à toutes les autres couches. En revanche, quand <code>aes()</code> est spécifié dans une couche donnée, les réglages ne s’appliquent qu’à cette couche spécifique.</p>
<p>En l’occurence, si le même réglage est spécifié dans la fonction <code>ggplot()</code> et dans une fonction <code>geom_XXX()</code>, c’est le réglage spécifié dans l’objet géométrique qui l’emporte :</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">ggplot</span>(small_weather, <span class="kw">aes</span>(<span class="dt">x =</span> time_hour, <span class="dt">y =</span> temp, <span class="dt">color =</span> wind_speed)) <span class="op">+</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wind4"></span>
<img src="figure/wind4-1.png" alt="Températures horaires et vitesse du vent à l'aéroport de Newark entre le 1er et le 15 janvier 2013" width="90%" />
<p class="caption">
Figure 4.27: Températures horaires et vitesse du vent à l’aéroport de Newark entre le 1er et le 15 janvier 2013
</p>
</div>
<p>il est ainsi possible de spécifier des éléments esthétiques qui s’appliqueront à toutes les couches d’un graphique, et d’autres qui ne s’appliqueront qu’à une couche spécifique, qu’à un objet géométrique particulier.</p>
<hr />
</div>
</div>
<div id="histogram" class="section level2">
<h2><span class="header-section-number">4.5</span> Les histogrammes</h2>
<p>Un histogramme permet de visualiser la distribution <strong>d’une variable</strong> numérique continue. Contrairement aux deux types de graphiques vus précédemment, il sera donc inutile de préciser la variable à associer à l’axe des ordonnées : R la calcule automatiquement pour nous lorsque nous faisons appel à la fonction <code>geom_histogram()</code> pour créer un objet géométrique “histogramme”.</p>
<div id="lobjet-geom_histogram" class="section level3">
<h3><span class="header-section-number">4.5.1</span> L’objet <code>geom_histogram()</code></h3>
<p>Si on reprend le jeu de données <code>weather</code>, on peut par exemple s’intéresser à la distribution des températures tout au long de l’année :</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>()</a></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-47"></span>
<img src="figure/unnamed-chunk-47-1.png" alt="Histogramme des températures enregistrées en 2013 dans les 3 aéroports de New York" width="90%" />
<p class="caption">
Figure 4.28: Histogramme des températures enregistrées en 2013 dans les 3 aéroports de New York
</p>
</div>
<p>On observe plusieurs choses :</p>
<ol style="list-style-type: decimal">
<li>La distribution semble globalement bimodale avec un pic autour de 36-37 degrés farenheit (2 à 3 ºC) et un autre autour de 65-70 degrés farenheit (18-21 ºC).</li>
<li>Les températures ont varié de 12 degrés farenheit (-11ºC) à 100 degrés farenheit (près de 38ºC).</li>
<li>R nous avertit qu’une valeur non finie n’a pas pu être intégrée</li>
<li>R nou indique qu’il a choisi de représenter 30 classes de températures (<code>bins = 30</code>). C’est la valeur par défaut. R nous conseille de choisir une valeur plus appropriée.</li>
</ol>
<p>Comme pour les nuages de points utilisant les symboles 21 à 24, il est possible de spécifier la couleur de remplissage des barres avec l’argument <code>fill</code> et la couleur du contour des barres avec l’argument <code>color</code> :</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;grey80&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-48"></span>
<img src="figure/unnamed-chunk-48-1.png" alt="Utilisation des arguments `fill` et `color` pour modifier l'aspect de l'histogramme." width="90%" />
<p class="caption">
Figure 4.29: Utilisation des arguments <code>fill</code> et <code>color</code> pour modifier l’aspect de l’histogramme.
</p>
</div>
</div>
<div id="la-taille-des-classes" class="section level3">
<h3><span class="header-section-number">4.5.2</span> La taille des classes</h3>
<p>Par défaut, R choisit arbitrairement de représenter 30 classes. Ce n’est que rarement le bon choix, et il est souvent nécessaire de tâtonner pour trouver le nombre de classes : celui qui permet d’avoir une idée correcte de la distribution des données.</p>
<p>Il est possible d’ajuster les caractéristiques des classes de l’histogramme de l’une des 3 façons suivantes :</p>
<ol style="list-style-type: decimal">
<li>en ajustant le nombre de classes avec <code>bins</code></li>
<li>en précisant la largeur des classes avec <code>binwidth</code></li>
<li>en fournissant manuellement les limites des classes avec <code>breaks</code></li>
</ol>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">60</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-49"></span>
<img src="figure/unnamed-chunk-49-1.png" alt="Modification du nombre de classes" width="90%" />
<p class="caption">
Figure 4.30: Modification du nombre de classes
</p>
</div>
<p>Ici, augmenter le nombre de classes à 60 permet de prendre conscience que la distribution n’est pas aussi lisse qu’elle en avait l’air. L’ajout d’une couche supplémentaire avec la fonction <code>geom_rug()</code> (“a rug” est un tapis en français) permet de prendre conscience que les données de température ne sont pas aussi continues qu’on pouvait le croire :</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">60</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-50"></span>
<img src="figure/unnamed-chunk-50-1.png" alt="Ajout des données brutes sous forme de 'tapis' (`rug`) sous l'histogramme." width="90%" />
<p class="caption">
Figure 4.31: Ajout des données brutes sous forme de ‘tapis’ (<code>rug</code>) sous l’histogramme.
</p>
</div>
<p>Notez la transparence importante utilisée pour <code>geom_rug()</code>. On constate que la précision des relevés de température n’est en fait que de quelques dixièmes de degrés.</p>
<p>On peut également modifier la largeur des classes avec <code>binwidth</code> :</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb112-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-51"></span>
<img src="figure/unnamed-chunk-51-1.png" alt="Modification de la largeur des classes avec `binwidth`" width="90%" />
<p class="caption">
Figure 4.32: Modification de la largeur des classes avec <code>binwidth</code>
</p>
</div>
<p>Ici chaque catégorie recouvre 10 degrés farenheit, ce qui est probablement trop large puisque la bimodalité de la distribution est devenue presque invisible. Enfin, il est possible de déterminer manuellement les limites des classes souhaitées avec l’argument <code>breaks</code> :</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">105</span>), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-52"></span>
<img src="figure/unnamed-chunk-52-1.png" alt="Spécification manuelle des limites de classes de tailles (classes irrégulières)" width="90%" />
<p class="caption">
Figure 4.33: Spécification manuelle des limites de classes de tailles (classes irrégulières)
</p>
</div>
<p>Vous constatez ici que les choix effectués ne sont pas très pertinents : toutes les classes n’ont pas la même largeur. Cela rend l’interprétation difficile. Il est donc vivement conseillé, pour spécifier <code>breaks</code>, de créer des suites régulières, comme avec la fonction <code>seq()</code> par exemple (consultez son fichier d’aide et les exemples !) :</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">limits &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">10</span>, <span class="dt">to =</span> <span class="dv">105</span>, <span class="dt">by =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">limits</a></code></pre></div>
<pre><code> [1]  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95 100
[20] 105</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">breaks =</span> limits, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:break"></span>
<img src="figure/break-1.png" alt="Un exemple d'utilisation de l'argument `break`" width="90%" />
<p class="caption">
Figure 4.34: Un exemple d’utilisation de l’argument <code>break</code>
</p>
</div>
<p>Il est important que toute la gamme des valeurs de <code>temp</code> soit couverte par les limites des classes que nous avons définies, sinon, certaines valeurs sont omises et l’histogramme est donc incomplet/incorrect. Une façon de s’en assurer est d’afficher les résumé des données pour la colonne <code>temp</code> du jeu de données <code>weather</code> :</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">summary</span>(weather<span class="op">$</span>temp)</a></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
  10.94   39.92   55.40   55.26   69.98  100.04       1 </code></pre>
<p>On voit ici que les températures varien de 10.94 à 100.04 degrés farenheit. Les classes que nous avons définies couvrent une plage de température plus large (de 10 à 105). Toutes les données sont donc bien intégrées à l’histogramme.</p>
<hr />
</div>
</div>
<div id="facets" class="section level2">
<h2><span class="header-section-number">4.6</span> Les <code>facet</code>s</h2>
<div id="facet_wrap" class="section level3">
<h3><span class="header-section-number">4.6.1</span> <code>facet_wrap()</code></h3>
<p>Nous l’avons indiqué plus haut, les <code>facet</code>s permettent de scinder le jeux de données en plusieurs sous-groupes et de faire un graphique pour chacun des sous-groupes.</p>
<p>Ainsi, si l’on souhaite connaître la distribution des températures pour chaque mois de l’année 2013, plutôt que de faire ceci :</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">fill =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-54"></span>
<img src="figure/unnamed-chunk-54-1.png" alt="Distribution des températures avec visualisation des données mensuelles." width="90%" />
<p class="caption">
Figure 4.35: Distribution des températures avec visualisation des données mensuelles.
</p>
</div>
<p>qui produit un graphique certes assez joli, mais difficile à interpréter, mieux vaut faire ceci :</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">fill =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="kw">factor</span>(month), <span class="dt">ncol =</span> <span class="dv">3</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:wrap"></span>
<img src="figure/wrap-1.png" alt="Un exemple d'utilisation de `facet_wrap()`" width="90%" />
<p class="caption">
Figure 4.36: Un exemple d’utilisation de <code>facet_wrap()</code>
</p>
</div>
<p>La couche supplémentaire créée avec <code>facet_wrap</code> permet donc de scinder les données en fonction d’une variable. Attention à la syntaxe ; il ne faut pas oublier le symbole <code>~</code> devant la variable que l’on souhaite utiliser pour scinder les données. Il va sans dire que la variable utilisée doit être catégorielle et non continue, c’est la raison pour laquelle j’utilise la notation <code>factor(month)</code> et non simplement <code>month</code>.</p>
<p>Avec la fonction <code>facet_wrap()</code>, il est possible d’indiquer à R comment les différents graphiques doivent être agencés en spécifiant soit le nombre de colonnes souhaité avec <code>ncol</code>, soit le nombre de lignes souhaitées avec <code>nrow</code>.</p>
</div>
<div id="facet_grid" class="section level3">
<h3><span class="header-section-number">4.6.2</span> <code>facet_grid()</code></h3>
<p>Une autre fonction nommée <code>facet_grid()</code> permet d’agencer des sous-graphiques selon 2 variables catégorielles. Par exemple :</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">fill =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb121-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">factor</span>(month) <span class="op">~</span><span class="st"> </span>origin)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:grid"></span>
<img src="figure/grid-1.png" alt="Un exemple d'utilisation de `facet_grid()`" width="90%" />
<p class="caption">
Figure 4.37: Un exemple d’utilisation de <code>facet_grid()</code>
</p>
</div>
<p>Ici, nous avons utilisé la variable <code>month</code> (transformée en facteur) et la variable <code>origin</code> pour créer un histogramme pour chaque combinaison des modalités de ces 2 variables. Il est donc possible comparer facilement des températures inter-mensuelles au sein d’un aéroport donné (en colonnes), ou de comparer des températures enregistrées le même mois dans des aéroports distincts (en lignes).</p>
<p><code>facet_grid()</code> doit elle aussi être utilisée avec le symbole <code>~</code>. Comme pour les indices d’un tableau, on met à gauche du <code>~</code> la variable qui figurera en lignes, et à droite du <code>~</code> celle qui figurera en colonnes. Les arguments <code>nrow</code> et <code>ncol</code> ne peuvent donc pas être utilisés : c’est le nombre de niveaux de chaque variable catégorielle fournie à <code>facet_grid()</code> qui détermine le nombre de lignes et de colonnes du graphique.</p>
<p>Vous devriez maintenant être convaincus de la puissance de la grammaire des graphiques. En utilisant un langage standardisé et en ajoutant des couches une à une sur un graphique, il est posible d’obtenir rapidement des visualisations très complexes et néanmoins très claires, qui font apparaître des srtuctures intéressantes dans nos données (des tendances, des groupes, des similitudes, des liaisons, des différences, etc).</p>
</div>
<div id="exercices-4" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Exercices</h3>
<p>Examinez la figure <a href="viz.html#fig:grid">4.37</a>.</p>
<ol style="list-style-type: decimal">
<li>Quels éléments nouveaux ce graphiques nous apprend-il par rapport au graphique <a href="viz.html#fig:break">4.34</a> ci-dessus ? Comment le “<code>facet</code>ing” nous aide-t’il à visualiser les relations entre 2 (ou 3) variables ?</li>
<li>À quoi correspondent les numéros 1 à 12 ?</li>
<li>À quoi correspondent les chiffres 25, 50, 75, 100 ?</li>
<li>À quoi correspondent les chiffres 0, 100, 200, 300 ?</li>
<li>Observez les échelles des axes <code>x</code> et <code>y</code> pour chaque sous graphique. Qu’on-t’elles de particulier ? En quoi est-ce utile ?</li>
<li>La variabilité des températures est-elle plus importante entre les aéroports, entre les mois, ou au sein des mois ? Expliquez votre réflexion.</li>
</ol>
<hr />
</div>
</div>
<div id="les-boites-a-moustaches-ou-boxplots" class="section level2">
<h2><span class="header-section-number">4.7</span> Les boîtes à moustaches ou boxplots</h2>
<div id="creation-de-boxplots-et-informations-apportees" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Création de boxplots et informations apportées</h3>
<p>Commençons par créer un boxplot pour comparer les températures mensuelles comme nous l’avons fait plus haut avec des histogrammes :</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> month, <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<pre><code>Warning: Continuous x aesthetic -- did you forget aes(group=...)?</code></pre>
<pre><code>Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-55"></span>
<img src="figure/unnamed-chunk-55-1.png" alt="Un boxplot for peu utile..." width="90%" />
<p class="caption">
Figure 4.38: Un boxplot for peu utile…
</p>
</div>
<p>Comme précédemment, R nous avertit qu’une observation n’a pas été intégrée (en raison d’une donnée manquante). Mais il nous dit aussi que <code>x</code> (pour nous, la variable <code>month</code>) est continue, et que nous avons probablement oublié de spécifier des groupes.</p>
<p>En effet, les boxplots sont généralement utilisés pour examiner la distribution d’une variable numérique pour chaque niveau d’une variable catégorielle (un facteur). Il nous faut donc, ici encore, transformer <code>month</code> en facteur car dans notre tableau de départ, cette variable est considérée comme une variable numérique continue :</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-56"></span>
<img src="figure/unnamed-chunk-56-1.png" alt="Boxplot des températures mensuelles" width="90%" />
<p class="caption">
Figure 4.39: Boxplot des températures mensuelles
</p>
</div>
<p>Les différents éléments d’un boxplot, sont les suivants :</p>
<ul>
<li>la limite inférieure de la boîte correspond au premier quartile : 25% des données de l’échantillon sont situées sous cette valeur</li>
<li>la limite supérieure de la boîte correspond au troisième quartile : 25% des données de l’échantillon sont situées au-dessus de cette valeur</li>
<li>le segment épais à l’intérieur de la boîte corrspond au second quartile : c’est la médiane de l’échantillon. 50% des données de l’échantillon sont situées au dessus de cette valeur, et 50% au dessous.</li>
<li>la hauteur de la boîte correspond à ce que l’on appelle l’étendue inter-quartile ou Inter Quartile Range (IQR) en anglais. On trouve dans cette boîte 50% des observations de l’échantillon. C’est une mesure de la dispersion des 50% des données les plus centrales. Une boîte plus allongée indique donc une plus grande dispersion.</li>
<li>les moustaches correspondent à des valeurs qui sont en dessous du premier quartile (pour la moustache du bas) et au-dessus du troisième quartile (pour la moustache du haut). La règle utilisée dans R est que ces moustaches s’étendent jusqu’aux valeurs minimales et maximales de l’échantillon, mais elles ne peuvent en aucun cas s’étendre au-delà de 1,5 fois la hauteur de la boîte (1,5 fois l’IQR) vers le haut et le bas. Si des points apparaissent au-delà des moustaches (vers le haut ou le bas), ces points sont appelés “outliers”. Ce sont des points qui s’éloignent du centre de la distribution de façon importante puisqu’ils sont au-delà de 1,5 fois l’IQR de part et d’autres du premier ou du troisième quartile. Il peut s’agir d’anomalies de mesure, d’anomalies de saisie de données, ou tout simplement, d’enregistrement tout à fait valides mais extrêmes. J’attire votre attention sur le fait que la définition de ces outliers est relativement arbitraire. Nous pourrions faire le choix d’étendre les moustaches jusqu’à 1,8 fois l’IQR (ou 2, ou 2,5). Nous observerions alors beaucoup moins d’outliers. D’une façons générale, la longueur des moustaches renseigne sur la variabilité des données en dehors de la zone centrale. Plus elles sont longues, plus la variabilité est importante. Et dans tous les cas, l’examen attentif des outliers est utile car il nous permet d’en apprendre plus sur le comportement extrême de certaines observations.</li>
</ul>
</div>
<div id="lintervalle-de-confiance-a-95-de-la-mediane" class="section level3">
<h3><span class="header-section-number">4.7.2</span> L’intervalle de confiance à 95% de la médiane</h3>
<p>On peut également aujouter une encoche autour de la valeur de médiane en ajoutant l’argument <code>notch = TRUE</code> à la fonction <code>geom_boxplot()</code> :</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">ggplot</span>(weather, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> temp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">notch =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:notchedboxplot"></span>
<img src="figure/notchedboxplot-1.png" alt="Boxplot des températures mensuelles. Les intervalles de confiance à 95% de la médiane sont affichés." width="90%" />
<p class="caption">
Figure 4.40: Boxplot des températures mensuelles. Les intervalles de confiance à 95% de la médiane sont affichés.
</p>
</div>
<p>Comme l’indique la légende de la figure <a href="viz.html#fig:notchedboxplot">4.40</a>, cette encoche correspond à l’étendue de l’intervalle de confiance à 95% de la médiane. Pour chaque échantillon, nous espérons que la médiane calculée soit le reflet fidèle de la vraie valeur de médiane de la population. Mais il sera toujours impossible d’en avoir la certitude absolue. Le mieux que l’on puisse faire, c’est quantifier l’incertitude. L’intervalle de confiance nous indique qu’il ya de bonnes chances que la vraie valeur de médiane de la population générale (qui restera à jamais inconnue) a de bonnes chances de se trouver dans cet intervalle. Ici, les encoches sont très étroites car les données sont abondantes. il y a donc peu d’incertitude, ce qui est une bonne chose.<br />
Nous reviendrons sur cette notion importante plus tard dans le cursus, car ce type de graphique nous permettra d’anticiper sur les résultats des tests de comparaison de moyennes.</p>
</div>
<div id="une-autre-facon-dexaminer-des-distributions" class="section level3">
<h3><span class="header-section-number">4.7.3</span> Une autre façon d’examiner des distributions</h3>
<p>Dernière chose concernant les boxplots : il s’agit d’une représentation graphique très proche de l’histogramme. Pour vous en convaincre, je représente à la figure <a href="viz.html#fig:compboxplot">4.41</a> ci-dessous uniquement les temperatures du mois de novembre, avec 3 types d’objets géométriques différents : un histogramme, un boxplot, et un nuage de points.</p>
<div class="figure" style="text-align: center"><span id="fig:compboxplot"></span>
<img src="figure/compboxplot-1.png" alt="Distribution des températures de Novembre 2013" width="90%" />
<p class="caption">
Figure 4.41: Distribution des températures de Novembre 2013
</p>
</div>
<p>Nous avons donc, à gauche un histogramme pour les températures de novembre (j’ai permuté les axes pour que <code>y</code> porte la température pour les 3 graphiques), au centre, un boxplot pour ces mêmes données, et à droite, les données brutes, sous la forme d’un nuage de point créé avec <code>geom_jitter()</code>. On voit bien que ces 3 représentations graphiques sont similaires. Toutes rendent compte du fait que les températures de Novembre sont majoritairement comprises entre 35 et 52 degrés farenheit. Au-delà de cette fourchette (au-dessus comme en-dessous) les observations sont plus rares.</p>
<p>Le nuage de points affiche toutes les données. C’est donc lui le plus complet mais pas forcément le plus lisible. Les points sont en effet très nombreux et la lecture du graphique peut s’en trouver compliquée. L’histogramme simplifie les données en les regroupant dans des classes. C’est une sorte de résumé des données. On constate cependant toujours la présence de 2 pics qui correspondent aux zones plus denses du nuage de points. Le boxplot enfin synthétise encore plus ces données. Elles sont résumées par 7 valeurs seulement : le minimum, le maximum, les 3 quartiles, et les bornes de l’intervalle de confiance à 95% de la médiane. C’est une représentation très synthétique qui nous permet de comparer beaucoup de catégories côte à côte (voir la figure <a href="viz.html#fig:notchedboxplot">4.40</a> un peu plus haut), mais qui est forcément moins précise qu’un histogramme. Vous noterez toutefois que la boîte du boxplot recouvre en grande partie la zone des 2 pics de l’histogramme. En outre, sur la figure <a href="viz.html#fig:notchedboxplot">4.40</a>, la tendance générale est très visible : il fait plus chaud en été qu’en hiver (étonnant non ?).</p>
</div>
<div id="pour-conclure" class="section level3">
<h3><span class="header-section-number">4.7.4</span> Pour conclure</h3>
<p>Les boîtes à moustaches permettent donc de comparer et contraster la distribution d’<strong>une variable quantitative</strong> pour plusieurs niveaux d’<strong>une variable catégorielle</strong>. On peut voir où la médiane tombe dans les différents groupes en observant la position de la ligne centrale dans la boîte. Pour avoir une idée de la dispersion de la variable au sein de chaque groupe, regardez à la fois la hauteur de la boîte et la longueur des moustaches. Quand les moustaches s’étendent loin de la boîte mais que la boîte est petite, cela signifie que la variabilité des valeurs proches du centre de la distribution est beaucoup plus faible que la variabilité des valeurs extrêmes. Enfin, les valeurs extrêmes ou aberrantes sont encore plus faciles à détecter avec une boîte à moustaches qu’avec un histogramme.</p>
<hr />
</div>
</div>
<div id="les-diagrammes-batons" class="section level2">
<h2><span class="header-section-number">4.8</span> Les diagrammes bâtons</h2>
<p>Comme nous venons de le voir, les histogrammes et les boîtes à moustaches permettent de visualiser la distribution d’une <strong>variable numérique continue</strong>. Nous aurons aussi souvent besoin de visualiser la distribution d’une <strong>variable catégorielle</strong>. C’est une tâche plus simple qui consiste à compter combien d’éléments tombent dans chacune des catégories de la variable catégorielle. Le meilleur moyen de visualiser de telles données de comptage (<em>aka</em> fréquences) est de réaliser un diagramme bâtons, autrement appelé <strong>barplot</strong> ou <strong>barchart</strong>.</p>
<p>Une difficulté, toutefois, concerne la façon dont les données sont présentées : est-ce que la variable d’intérêt est “pré-comptée” ou non ? Par exemple, le code ci-dessous crée 2 <code>data.frame</code> qui représentent la même collection de fruits : 3 pommes et 2 oranges :</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">fruits &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">fruit =</span> <span class="kw">c</span>(<span class="st">&quot;pomme&quot;</span>, <span class="st">&quot;pomme&quot;</span>, <span class="st">&quot;pomme&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;orange&quot;</span>))</a>
<a class="sourceLine" id="cb127-2" data-line-number="2">fruits</a></code></pre></div>
<pre><code># A tibble: 5 x 1
  fruit 
  &lt;chr&gt; 
1 pomme 
2 pomme 
3 pomme 
4 orange
5 orange</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">fruits_counted &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">fruit =</span> <span class="kw">c</span>(<span class="st">&quot;pomme&quot;</span>, <span class="st">&quot;orange&quot;</span>), <span class="dt">nombre =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb129-2" data-line-number="2">fruits_counted</a></code></pre></div>
<pre><code># A tibble: 2 x 2
  fruit  nombre
  &lt;chr&gt;   &lt;dbl&gt;
1 pomme       3
2 orange      2</code></pre>
<div id="representation-graphique-avec-geom_bar-et-geom_col" class="section level3">
<h3><span class="header-section-number">4.8.1</span> Représentation graphique avec <code>geom_bar</code> et <code>geom_col</code></h3>
<p>Pour visualiser les données non pré-comptées, on utilise <code>geom_bar()</code> :</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> fruits, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> fruit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barplot"></span>
<img src="figure/barplot-1.png" alt="Barplot pour des données non pré-comptées." width="90%" />
<p class="caption">
Figure 4.42: Barplot pour des données non pré-comptées.
</p>
</div>
<p>Pour visualiser les données déjà pré-comptées, on utilise <code>geom_col()</code> :</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> fruits_counted, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> fruit, <span class="dt">y =</span> nombre)) <span class="op">+</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barplotcol"></span>
<img src="figure/barplotcol-1.png" alt="Barplot pour des données pré-comptées." width="90%" />
<p class="caption">
Figure 4.43: Barplot pour des données pré-comptées.
</p>
</div>
<p>Notez que les figures <a href="viz.html#fig:barplot">4.42</a> et <a href="viz.html#fig:barplotcol">4.43</a> sont absolument identiques (à l’exception du titre de l’axe des ordonnées), mais qu’elles ont été créées à partir de 2 tableaux de données différents. En particulier, notez que :</p>
<ul>
<li>le code qui génère la figure <a href="viz.html#fig:barplot">4.42</a> utilise le jeu de données <code>fruits</code>, et n’associe pas de variable à l’axe des ordonnées : dans la fonction <code>aes()</code>, seule la variable associée à <code>x</code> est précisée. C’est la fonction <code>geom_bar()</code> qui calcule automatiquement les abondances (ou fréquences) pour chaque catégorie de la variable <code>fruit</code>. La variable <code>count</code> est ainsi générée automatiquement et associée à <code>y</code>.</li>
<li>le code qui génère la figure <a href="viz.html#fig:barplotcol">4.43</a> utilise le jeu de données <code>fruits_counted</code>. Ici, la variable <code>nombre</code> est associée à l’axe des <code>y</code> grâce à la fonction <code>aes()</code>. La fonction <code>geom_col()</code> a besoin de 2 variables (une variable catégorielle pour l’axe des <code>x</code> et une numérique pour l’axe des <code>y</code>) pour fonctionner.</li>
</ul>
<p>Autrement dit, lorsque vous souhaiterez créer un diagramme bâtons, il faudra donc au préalable vérifier de quel type de données vous disposez pour choisir l’objet géométrique approprié :</p>
<ul>
<li>Si votre variable catégorielle n’est pas pré-comptée dans votre tableau de données, il faut utiliser <code>geom_bar()</code></li>
<li>Si votre variable catégorielle est pré-comptée dans votre tableau de données, il faut utiliser <code>geom_col()</code> et associer explicitement les comptages à l’aesthétique <code>y</code> du graphique.</li>
</ul>
</div>
<div id="un-example-concret" class="section level3">
<h3><span class="header-section-number">4.8.2</span> Un example concret</h3>
<p>Revenons à <code>nycflights13</code>. Imaginons que nous souhaitions connaître le nombre de vols affrétés par chaque compagnie aérienne au départ de New York en 2013. Dans le jeu de données <code>flights</code>, la variable <code>carrier</code> nous indique à quelle compagnie aérienne appartiennent chacun des 336776 vols ayant quitté New York en 2013. Une façon simple de représenter ces données est donc la suivante :</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carrier)) <span class="op">+</span></a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bpcarrier"></span>
<img src="figure/bpcarrier-1.png" alt="Nombre de vols par compagnie aérienne au départ de New York en 2013." width="90%" />
<p class="caption">
Figure 4.44: Nombre de vols par compagnie aérienne au départ de New York en 2013.
</p>
</div>
<p>Ici, <code>geom_bar()</code> a compté le nombre d’occurences de chaque compagnie aérienne dans le tableau <code>flights</code> et a automatiquement associé ce nombre à l’axe des ordonnées.</p>
<p>Il est généralement plus utile de trier les catégories par ordre décroissant. Nous pouvons faire cela facilement grâce à la fonction <code>fct_infreq()</code> du package <code>forcats</code>. Si vous avez installé le <code>tidyverse</code>, le package <code>forcast</code> doit être disponible sur votre ordinateur. N’oubliez pas de le charger si besoin :</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier))) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bpcarriersorted"></span>
<img src="figure/bpcarriersorted-1.png" alt="Nombre de vols par compagnie aérienne au départ de New York en 2013." width="90%" />
<p class="caption">
Figure 4.45: Nombre de vols par compagnie aérienne au départ de New York en 2013.
</p>
</div>
<p>Ordonner les catégories par ordre décroissant est souvent indispensable afin de faciliter la lecture du graphique et les comparaisons entre catégories.</p>
<p>Si nous souhaitons connaître le nombre de vols précis de chaque compagnie aérienne, il nous faut faire appel à plusieurs fonctions du package <code>dplyr</code> que nous détaillerons dans le chapitre <a href="wrangling.html#wrangling">6</a>. Ci-dessous, nous créons un nouveau tableau <code>carrier_table</code> contenant le nombre de vols de chaque compagnie aérienne et les compagnies sont ordonnées par nombre de vols décroissants :</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">carrier_table &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># Pour créer une nouvelle table, on prend flights, puis...</span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># On groupe les données par compagnie aérienne, puis...</span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">nombre =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># On calcule le nombre de vols par compagnie, puis ...</span></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(nombre))        <span class="co"># On trie le tableau par nombre de vols décroissant.</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5">carrier_table                  <span class="co"># Enfin, on affiche la nouvelle table</span></a></code></pre></div>
<pre><code># A tibble: 16 x 2
   carrier nombre
   &lt;chr&gt;    &lt;int&gt;
 1 UA       58665
 2 B6       54635
 3 EV       54173
 4 DL       48110
 5 AA       32729
 6 MQ       26397
 7 US       20536
 8 9E       18460
 9 WN       12275
10 VX        5162
11 FL        3260
12 AS         714
13 F9         685
14 YV         601
15 HA         342
16 OO          32</code></pre>
<p>Ici, la table a été triée par nombre de vols décroissants. Mais attention, <strong>les niveaux</strong> du facteur <code>carrier</code> n’ont pas été modifiés :</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">factor</span>(carrier_table<span class="op">$</span>carrier)</a></code></pre></div>
<pre><code> [1] UA B6 EV DL AA MQ US 9E WN VX FL AS F9 YV HA OO
Levels: 9E AA AS B6 DL EV F9 FL HA MQ OO UA US VX WN YV</code></pre>
<p>Le premier niveau est toujours <code>9E</code>, puis <code>AA</code>, puis <code>AS</code>, et non l’ordre du tableau nouvellement créé (<code>UA</code>, puis <code>B6</code>, puis <code>EV</code>…) car les niveaux sont toujours triés par ordre alphabétique. La conséquence est que faire un barplot avec ces données et la fonction <code>geom_col()</code> ne permet pas d’ordonner les catégories correctement :</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="kw">ggplot</span>(carrier_table, <span class="kw">aes</span>(<span class="dt">x =</span> carrier, <span class="dt">y =</span> nombre)) <span class="op">+</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bpcarriercol"></span>
<img src="figure/bpcarriercol-1.png" alt="Nombre de vols par compagnie aérienne au départ de New York en 2013." width="90%" />
<p class="caption">
Figure 4.46: Nombre de vols par compagnie aérienne au départ de New York en 2013.
</p>
</div>
<p>Pour parvenir à nos fins, il faut cette fois avoir recours à la fonction <code>fct_reorder()</code> pour ordonner correctement les catégories. Cette fonction prends 3 arguments :</p>
<ol style="list-style-type: decimal">
<li>la variable catégorielle dont on souhaite réordonner les niveaux (ici, la variable <code>carrier</code> du tableau <code>carrier_table</code>)</li>
<li>une variable numérique qui permet d’ordonner les catégories (ici, la variable <code>nombre</code> du même tableau)</li>
<li>l’argument optionnel <code>.desc</code> qui permet de préciser si le tri doit être fait en ordre croissant (c’est le cas par défaut) ou décroissant.</li>
</ol>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="kw">ggplot</span>(carrier_table, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(carrier, nombre, <span class="dt">.desc =</span> <span class="ot">TRUE</span>), <span class="dt">y =</span> nombre)) <span class="op">+</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_col</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:bpcarriersortedcol"></span>
<img src="figure/bpcarriersortedcol-1.png" alt="Nombre de vols par compagnie aérienne au départ de New York en 2013." width="90%" />
<p class="caption">
Figure 4.47: Nombre de vols par compagnie aérienne au départ de New York en 2013.
</p>
</div>
<p>Vous voyez donc que selon le type de données dont vous disposez (soit un tableau comme <code>flights</code>, avec toutes les observations, soit un tableau beaucou plus compact comme <code>carrier_table</code>), la démarche permettant de produire un diagramme bâton, dans lequel les catégories seront triées, sera différente.</p>
</div>
<div id="exercices-5" class="section level3">
<h3><span class="header-section-number">4.8.3</span> Exercices</h3>
<ol style="list-style-type: decimal">
<li>Quelle est la différence entre un histogramme et un diagramme bâtons ?</li>
<li>Pourquoi les histogrammes sont-ils inadaptés pour visualiser des données catégorielles ?</li>
<li>Quel est le nom de la companie pour laquelle le plus grand nombre de vols ont quitté New York en 2013 (je veux connaître son nom, pas juste son code) ? Où se trouve cette information ?</li>
<li>Quel est le nom de la companie pour laquelle le plus petit nombre de vols ont quitté New York en 2013 (je veux connaître son nom, pas juste son code) ? Où se trouve cette information ?</li>
</ol>
</div>
<div id="eviter-a-tout-prix-les-diagrammes-circulaires" class="section level3">
<h3><span class="header-section-number">4.8.4</span> Éviter à tout prix les diagrammes circulaires</h3>
<p>À mon grand désarroi, l’un des graphiques les plus utilisé pour représenter la distribution d’une variable catégorielle est le diagramme circulaire (ou diagramme camembert, ou piechart en anglais). C’est presque toujours la plus mauvaise visualisation possible. Je vous demande de l’éviter à tout prix. Notre cerveau n’est en effet pas correctement équipé pour comparer des angles. Ainsi, par exemple, nous avons naturellement tendance à surestimer les angles supérieurs à 90º, et à sous-estimer les angles inférieurs à 90º. En d’autres termes, il est difficile pour les humains de comparer des grandeurs sur des diagrammes circulaires.</p>
<p>À titre d’exemple, examinez ce diagramme, qui reprend les même chiffres que précédemment, et tentez de répondre aux questions suivantes :</p>
<div class="figure" style="text-align: center"><span id="fig:piechart"></span>
<img src="figure/piechart-1.png" alt="Nombre de vols par compagnie aérienne au départ de New York en 2013" width="90%" />
<p class="caption">
Figure 4.48: Nombre de vols par compagnie aérienne au départ de New York en 2013
</p>
</div>
<ul>
<li>Comparez les compagnies ExpressJet Airlines (<code>EV</code>) et US Airways (<code>US</code>). De combien de fois la part de <code>EV</code> est-elle supérieure à celle d’<code>US</code> ? (2 fois, 3 fois, 1.2 fois ?…)</li>
<li>Quelle est la troisième compagnie aérienne la plus importante en terme de nombre de vols au départ de New York en 2013 ?</li>
<li>Combien de companies aériennes ont moins de vols que United Airlines (<code>UA</code>) ?</li>
</ul>
<p>Il est difficile (voir impossible) de répondre précisément à ces questions avec le diagramme circulaire de la figure <a href="viz.html#fig:piechart">4.48</a>, alors qu’il est très simple d’obtenir des réponses précises avec un diagramme bâtons tel que présenté à la figure <a href="viz.html#fig:bpcarriersortedcol">4.47</a> (vérifiez-le !).</p>
</div>
<div id="comparer-2-variables-categorielles-avec-un-diagramme-baton" class="section level3">
<h3><span class="header-section-number">4.8.5</span> Comparer 2 variables catégorielles avec un diagramme bâton</h3>
<p>Il y a généralement 3 façons de procéder pour comparer la distribution de 2 variables catégorielles avec un diagramme bâtons :</p>
<ol style="list-style-type: decimal">
<li>Faire un graphique empilé</li>
<li>Faire un graphique juxtaposé</li>
<li>Utiliser les <code>facet</code>s</li>
</ol>
<p>Supposons par exemple que nous devions visualiser le nombre de vol de chaque compagnie aérienne, au départ de chacun des 3 aéroports de New York : John F. Kennedy (<code>JFK</code>), Newark (<code>EWR</code>) et La Guardia (LGA).</p>
<div id="graphique-empile" class="section level4">
<h4><span class="header-section-number">4.8.5.1</span> Graphique empilé</h4>
<p>La méthode la plus simple est celle du graphique empilé :</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:stacked"></span>
<img src="figure/stacked-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.49: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Notez qu’il s’agit du même code que celui utilisé pour la figure <a href="viz.html#fig:bpcarriersorted">4.45</a>, à une différence près : l’ajout de <code>fill = origin</code> dans la fonction <code>aes()</code>, qui permet d’associer l’aéroport d’origine à la couleur de remplissage des barres. <code>fill</code> est associé à une variable (ici, elle est catégorielle), il est donc indispensable de faire figurer cet argument à l’intérieur de la fonction <code>aes()</code>. Quand on associe une variable à une caractéristique esthétique du graphique, on fait toujours figurer le code à l’intérieur de la fonction <code>aes()</code> (comme quand on associe une variable aux axes du graphique par exemple).</p>
<p>À mon sens, le graphique peut gagner en lisibilité si on ajoute une couleur pour le contour des barres :</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb142-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:stacked2"></span>
<img src="figure/stacked2-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.50: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Notez que contrairement à <code>fill</code>, cette couleur de countour est un paramètre fixe : elle n’est pas associée à une variable et doit donc être placée en dehors de la fonction <code>aes()</code>.</p>
<p>Bien que ces graphiques empilés soient très simples à réaliser, ils sont parfois difficiles à lire. En particulier, il n’est pas toujours aisé de comparer les hauteurs des différentes couleurs (qui correspondent ici aux nombres de vols issus de chaque aéroport) entre barres différentes (qui correspondent ici aux compagnies aériennes).</p>
</div>
<div id="graphique-juxtapose" class="section level4">
<h4><span class="header-section-number">4.8.5.2</span> Graphique juxtaposé</h4>
<p>Une variation sur le même thème consiste, non plus à empiler les barres de couleur les unes sur les autres, mais à les juxtaposer :</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:dodge"></span>
<img src="figure/dodge-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.51: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Passer d’un graphique empilé à un graphique juxtaposé est donc très simple : il suffit d’ajouter l’argument <code>position = &quot;dodge&quot;</code> à la fonction <code>geom_bar()</code>.</p>
<p>Là encore, la lecture de ces graphiques est souvent difficile car la comparaison des catégories qui figurent sur l’axe des <code>x</code> n’est pas immédiate. Elle est en outre rendue plus difficile par le fait que toutes les barres n’ont pas la même largeur. Par exemple, sur la figure <a href="viz.html#fig:dodge">4.51</a>, les 8 premières compagnies aériennes déservent les 3 aéroports de New York, mais les 2 suivantes (<code>WN</code> et <code>VX</code>) n’en déservent que 2, et les autres compagnie, qu’un seul. Puisque sur un barplot, seule la hauteur des barres compte, il faut prendre garde à ne pas se laisser influencer par la largeur des barres qui pourrait fausser notre perception.</p>
</div>
<div id="utilisation-des-facets" class="section level4">
<h4><span class="header-section-number">4.8.5.3</span> Utilisation des <code>facet</code>s</h4>
<p>La meilleure alternative est probablement l’utilisation de <code>facet</code>s que nous avons déjà décrite à la section <a href="viz.html#facets">4.6</a> :</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacet"></span>
<img src="figure/barfacet-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.52: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Ici, chaque graphique permet de comparer les compagnies aériennes au sein de l’un des aéroports de New York, et puisque l’ordre des compagnies aériennes est le même sur l’axe des <code>x</code> des 3 graphiques, une lecture verticale permet de comparer aisément le nombre de vols qu’une compagnie donnée a affrété dans chacun des 3 aéroports de New York.</p>
<hr />
</div>
</div>
</div>
<div id="de-lexploration-a-lexposition" class="section level2">
<h2><span class="header-section-number">4.9</span> De l’exploration à l’exposition</h2>
<p>Vous savez maintenant comment produire une grande variété de graphiques, permettant d’explorer vos données, de visualiser le comportement d’une ou plusieurs variables, et de mettre en évidence des tendances, des relations entre variables numérique et/ou catégorielles. Afin de rendre vos graphiques plus présentables dans un rapport, il ne vous reste plus qu’à vous familiariser avec quelques fonctions permettant d’annoter correctement vos graphiques et d’en modifier les légendes si nécessaire.</p>
<div id="les-labels" class="section level3">
<h3><span class="header-section-number">4.9.1</span> Les labels</h3>
<p>Le point de départ le plus évident est d’ajouter des labels de qualité. La fonction <code>labs()</code> du package <code>ggplot2</code> permet d’ajouter plusieurs types de labels sur vos graphiques :</p>
<ul>
<li>un titre : il doit résumer les résultats les plus importants</li>
<li>un sous-titre : il permet de donner quelques détails supplémentaires</li>
<li>une légende : souvent utilisée pour présenter la source des données du graphique</li>
<li>un titre pour chaque axe : permet de préciser les variables portées par les axes et leurs unités</li>
<li>un titre pour les légendes de couleurs, de forme, de taille, etc</li>
</ul>
<p>Reprenons par exemple le graphique de la figure <a href="viz.html#fig:varcolor">4.10</a> :</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">ggplot</span>(alaska_flights, <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay, <span class="dt">color =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolorlabel"></span>
<img src="figure/varcolorlabel-1.png" alt="Association de `color` à une variable catégorielle" width="90%" />
<p class="caption">
Figure 4.53: Association de <code>color</code> à une variable catégorielle
</p>
</div>
<p>Nous pouvons ajouter sur ce graphique les éléments précisés plus haut en ajoutant la fonction <code>labs()</code> sur une nouvelle couche du graphique :</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">ggplot</span>(alaska_flights, <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay, <span class="dt">color =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Relation linéaire positive entre le retard des vols au départ et à l&#39;arrivée&quot;</span>,</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">       <span class="dt">subtitle =</span> <span class="st">&quot;L&#39;essentiel des points est centré sur 0, mais certains retards dépassent 3 heures&quot;</span>,</a>
<a class="sourceLine" id="cb146-5" data-line-number="5">       <span class="dt">caption =</span> <span class="st">&quot;Source : nycflights13&quot;</span>,</a>
<a class="sourceLine" id="cb146-6" data-line-number="6">       <span class="dt">x =</span> <span class="st">&quot;Retard au départ de New York (minutes)&quot;</span>,</a>
<a class="sourceLine" id="cb146-7" data-line-number="7">       <span class="dt">y =</span> <span class="st">&quot;Retard à l&#39;arrivée à destination (minutes)&quot;</span>,</a>
<a class="sourceLine" id="cb146-8" data-line-number="8">       <span class="dt">color =</span> <span class="st">&quot;Mois&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolorlabel2"></span>
<img src="figure/varcolorlabel2-1.png" alt="Exemple d'utilisation de `labs()`" width="90%" />
<p class="caption">
Figure 4.54: Exemple d’utilisation de <code>labs()</code>
</p>
</div>
<p>À partir de maintenant, vous devriez systématiquement légender les axes de vos graphiques en n’oubliant pas de préciser les unités, pour tous les graphiques que vous intégrez dans vos rapports, compte-rendus, mémoires, etc.</p>
</div>
<div id="les-echelles" class="section level3">
<h3><span class="header-section-number">4.9.2</span> Les échelles</h3>
<p>Tous les aspects des graphiques que vous produisez peuvent être édités. C’est notamment le cas des échelles. Qu’il s’agisse de modifier l’étendue des axes, la densité du quadrillage, la position des tirets sur les axes, le nom des catégories figurant sur les axes ou dans les légendes ou encore les couleurs utilisées pour différentes catégories d’objets géométriques, tout est possible dans <code>ggplot2</code>.</p>
<p>Nous n’avons pas le temps ici d’aborder toutes ces questions en détail. Je vous encourage donc à consulter l’ouvrage en ligne intitulé <a href="http://r4ds.had.co.nz/">R for data science</a>, et en particulier <a href="http://r4ds.had.co.nz/graphics-for-communication.html#scales">son chapitre dédié aux échelles</a>, si vous avez besoin d’apporter des modifications à vos graphiques et que vous ne trouvez pas comment faire dans cet ouvrage.</p>
<p>Je vais ici uniquement détailler la façon de procéder pour modifier les couleurs choisies par défaut par <code>ggplot2</code>. Reprenons par exemple la figure <a href="viz.html#fig:barfacet">4.52</a>, en ajoutant au passage des titres corrects pour nos axes</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb147-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacetbis"></span>
<img src="figure/barfacetbis-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.55: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Notez que le caractère spécial <code>\n</code> permet de forcer un retour à la ligne. Ici, les 3 couleurs de remplissage (<code>fill</code>) utilisées pour différencier les 3 aéroports de New York ont été choisies par défaut par <code>ggplot2</code>. Il est possible de modifier ces couleurs de plusieurs façons :</p>
<ul>
<li>en utilisant d’autres palettes de couleurs prédéfinies</li>
<li>en utilisant des couleurs choisies manuellement</li>
</ul>
<p>Toutes les fonctions permettant d’altérer les légendes commencent par <code>scale_</code>. Vient ensuite le nom de l’esthétique que l’on souhaite modifier (ici <code>fill_</code>) et enfin, le nom d’une fonction à appliquer. Les possibilités sont nombreuses et vous pouvez en avoir un aperçu en tapant le début du nom de la fonction et en parcourant la liste proposée par RStudio sous le curseur.</p>
<p>Par exemple, pour utiliser des niveaux de gris plutôt que les couleurs, il suffit d’ajouter une couche à notre graphique :</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb148-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb148-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb148-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb148-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_grey</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacetgray"></span>
<img src="figure/barfacetgray-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.56: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Le package <code>RColorBrewer</code> propose une large gamme de palettes de couleurs :</p>
<div class="figure" style="text-align: center"><span id="fig:RcolorbrewerPalettes"></span>
<img src="images/brewer.png" alt="Toutes les palettes de couleur du package `RColorBrewer`" width="50%" />
<p class="caption">
Figure 4.57: Toutes les palettes de couleur du package <code>RColorBrewer</code>
</p>
</div>
<p><code>ggplot2</code> permet d’appliquer ces palettes très simplement :</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb149-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb149-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb149-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb149-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb149-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb149-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Accent&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacetbrewer"></span>
<img src="figure/barfacetbrewer-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.58: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>De même, le package <code>viridis</code> propose une palette de couleur intéressante qui maximise le contraste et facilite la disrimination des catégories pour les daltoniens. Là encore, <code>ggplot2</code> nous donne accès à cette palette :</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb150-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb150-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb150-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb150-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacetviridis"></span>
<img src="figure/barfacetviridis-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.59: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Enfin, si les palettes de couleur ne convienent pas, il est toujours possible de spécifier manuellement les couleurs souhaitées. R propose un accès rapide à 657 noms de couleurs. Pour afficher leurs noms, il suffit de taper :</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw">colors</span>()</a></code></pre></div>
<pre><code>  [1] &quot;white&quot;                &quot;aliceblue&quot;            &quot;antiquewhite&quot;        
  [4] &quot;antiquewhite1&quot;        &quot;antiquewhite2&quot;        &quot;antiquewhite3&quot;       
  [7] &quot;antiquewhite4&quot;        &quot;aquamarine&quot;           &quot;aquamarine1&quot;         
 [10] &quot;aquamarine2&quot;          &quot;aquamarine3&quot;          &quot;aquamarine4&quot;         
 [13] &quot;azure&quot;                &quot;azure1&quot;               &quot;azure2&quot;              
 [16] &quot;azure3&quot;               &quot;azure4&quot;               &quot;beige&quot;               
 [19] &quot;bisque&quot;               &quot;bisque1&quot;              &quot;bisque2&quot;             
 [22] &quot;bisque3&quot;              &quot;bisque4&quot;              &quot;black&quot;               
 [25] &quot;blanchedalmond&quot;       &quot;blue&quot;                 &quot;blue1&quot;               
 [28] &quot;blue2&quot;                &quot;blue3&quot;                &quot;blue4&quot;               
 [31] &quot;blueviolet&quot;           &quot;brown&quot;                &quot;brown1&quot;              
 [34] &quot;brown2&quot;               &quot;brown3&quot;               &quot;brown4&quot;              
 [37] &quot;burlywood&quot;            &quot;burlywood1&quot;           &quot;burlywood2&quot;          
 [40] &quot;burlywood3&quot;           &quot;burlywood4&quot;           &quot;cadetblue&quot;           
 [43] &quot;cadetblue1&quot;           &quot;cadetblue2&quot;           &quot;cadetblue3&quot;          
 [46] &quot;cadetblue4&quot;           &quot;chartreuse&quot;           &quot;chartreuse1&quot;         
 [49] &quot;chartreuse2&quot;          &quot;chartreuse3&quot;          &quot;chartreuse4&quot;         
 [52] &quot;chocolate&quot;            &quot;chocolate1&quot;           &quot;chocolate2&quot;          
 [55] &quot;chocolate3&quot;           &quot;chocolate4&quot;           &quot;coral&quot;               
 [58] &quot;coral1&quot;               &quot;coral2&quot;               &quot;coral3&quot;              
 [61] &quot;coral4&quot;               &quot;cornflowerblue&quot;       &quot;cornsilk&quot;            
 [64] &quot;cornsilk1&quot;            &quot;cornsilk2&quot;            &quot;cornsilk3&quot;           
 [67] &quot;cornsilk4&quot;            &quot;cyan&quot;                 &quot;cyan1&quot;               
 [70] &quot;cyan2&quot;                &quot;cyan3&quot;                &quot;cyan4&quot;               
 [73] &quot;darkblue&quot;             &quot;darkcyan&quot;             &quot;darkgoldenrod&quot;       
 [76] &quot;darkgoldenrod1&quot;       &quot;darkgoldenrod2&quot;       &quot;darkgoldenrod3&quot;      
 [79] &quot;darkgoldenrod4&quot;       &quot;darkgray&quot;             &quot;darkgreen&quot;           
 [82] &quot;darkgrey&quot;             &quot;darkkhaki&quot;            &quot;darkmagenta&quot;         
 [85] &quot;darkolivegreen&quot;       &quot;darkolivegreen1&quot;      &quot;darkolivegreen2&quot;     
 [88] &quot;darkolivegreen3&quot;      &quot;darkolivegreen4&quot;      &quot;darkorange&quot;          
 [91] &quot;darkorange1&quot;          &quot;darkorange2&quot;          &quot;darkorange3&quot;         
 [94] &quot;darkorange4&quot;          &quot;darkorchid&quot;           &quot;darkorchid1&quot;         
 [97] &quot;darkorchid2&quot;          &quot;darkorchid3&quot;          &quot;darkorchid4&quot;         
[100] &quot;darkred&quot;              &quot;darksalmon&quot;           &quot;darkseagreen&quot;        
[103] &quot;darkseagreen1&quot;        &quot;darkseagreen2&quot;        &quot;darkseagreen3&quot;       
[106] &quot;darkseagreen4&quot;        &quot;darkslateblue&quot;        &quot;darkslategray&quot;       
[109] &quot;darkslategray1&quot;       &quot;darkslategray2&quot;       &quot;darkslategray3&quot;      
[112] &quot;darkslategray4&quot;       &quot;darkslategrey&quot;        &quot;darkturquoise&quot;       
[115] &quot;darkviolet&quot;           &quot;deeppink&quot;             &quot;deeppink1&quot;           
[118] &quot;deeppink2&quot;            &quot;deeppink3&quot;            &quot;deeppink4&quot;           
[121] &quot;deepskyblue&quot;          &quot;deepskyblue1&quot;         &quot;deepskyblue2&quot;        
[124] &quot;deepskyblue3&quot;         &quot;deepskyblue4&quot;         &quot;dimgray&quot;             
[127] &quot;dimgrey&quot;              &quot;dodgerblue&quot;           &quot;dodgerblue1&quot;         
[130] &quot;dodgerblue2&quot;          &quot;dodgerblue3&quot;          &quot;dodgerblue4&quot;         
[133] &quot;firebrick&quot;            &quot;firebrick1&quot;           &quot;firebrick2&quot;          
[136] &quot;firebrick3&quot;           &quot;firebrick4&quot;           &quot;floralwhite&quot;         
[139] &quot;forestgreen&quot;          &quot;gainsboro&quot;            &quot;ghostwhite&quot;          
[142] &quot;gold&quot;                 &quot;gold1&quot;                &quot;gold2&quot;               
[145] &quot;gold3&quot;                &quot;gold4&quot;                &quot;goldenrod&quot;           
[148] &quot;goldenrod1&quot;           &quot;goldenrod2&quot;           &quot;goldenrod3&quot;          
[151] &quot;goldenrod4&quot;           &quot;gray&quot;                 &quot;gray0&quot;               
[154] &quot;gray1&quot;                &quot;gray2&quot;                &quot;gray3&quot;               
[157] &quot;gray4&quot;                &quot;gray5&quot;                &quot;gray6&quot;               
[160] &quot;gray7&quot;                &quot;gray8&quot;                &quot;gray9&quot;               
[163] &quot;gray10&quot;               &quot;gray11&quot;               &quot;gray12&quot;              
[166] &quot;gray13&quot;               &quot;gray14&quot;               &quot;gray15&quot;              
[169] &quot;gray16&quot;               &quot;gray17&quot;               &quot;gray18&quot;              
[172] &quot;gray19&quot;               &quot;gray20&quot;               &quot;gray21&quot;              
[175] &quot;gray22&quot;               &quot;gray23&quot;               &quot;gray24&quot;              
[178] &quot;gray25&quot;               &quot;gray26&quot;               &quot;gray27&quot;              
[181] &quot;gray28&quot;               &quot;gray29&quot;               &quot;gray30&quot;              
[184] &quot;gray31&quot;               &quot;gray32&quot;               &quot;gray33&quot;              
[187] &quot;gray34&quot;               &quot;gray35&quot;               &quot;gray36&quot;              
[190] &quot;gray37&quot;               &quot;gray38&quot;               &quot;gray39&quot;              
[193] &quot;gray40&quot;               &quot;gray41&quot;               &quot;gray42&quot;              
[196] &quot;gray43&quot;               &quot;gray44&quot;               &quot;gray45&quot;              
[199] &quot;gray46&quot;               &quot;gray47&quot;               &quot;gray48&quot;              
[202] &quot;gray49&quot;               &quot;gray50&quot;               &quot;gray51&quot;              
[205] &quot;gray52&quot;               &quot;gray53&quot;               &quot;gray54&quot;              
[208] &quot;gray55&quot;               &quot;gray56&quot;               &quot;gray57&quot;              
[211] &quot;gray58&quot;               &quot;gray59&quot;               &quot;gray60&quot;              
[214] &quot;gray61&quot;               &quot;gray62&quot;               &quot;gray63&quot;              
[217] &quot;gray64&quot;               &quot;gray65&quot;               &quot;gray66&quot;              
[220] &quot;gray67&quot;               &quot;gray68&quot;               &quot;gray69&quot;              
[223] &quot;gray70&quot;               &quot;gray71&quot;               &quot;gray72&quot;              
[226] &quot;gray73&quot;               &quot;gray74&quot;               &quot;gray75&quot;              
[229] &quot;gray76&quot;               &quot;gray77&quot;               &quot;gray78&quot;              
[232] &quot;gray79&quot;               &quot;gray80&quot;               &quot;gray81&quot;              
[235] &quot;gray82&quot;               &quot;gray83&quot;               &quot;gray84&quot;              
[238] &quot;gray85&quot;               &quot;gray86&quot;               &quot;gray87&quot;              
[241] &quot;gray88&quot;               &quot;gray89&quot;               &quot;gray90&quot;              
[244] &quot;gray91&quot;               &quot;gray92&quot;               &quot;gray93&quot;              
[247] &quot;gray94&quot;               &quot;gray95&quot;               &quot;gray96&quot;              
[250] &quot;gray97&quot;               &quot;gray98&quot;               &quot;gray99&quot;              
[253] &quot;gray100&quot;              &quot;green&quot;                &quot;green1&quot;              
[256] &quot;green2&quot;               &quot;green3&quot;               &quot;green4&quot;              
[259] &quot;greenyellow&quot;          &quot;grey&quot;                 &quot;grey0&quot;               
[262] &quot;grey1&quot;                &quot;grey2&quot;                &quot;grey3&quot;               
[265] &quot;grey4&quot;                &quot;grey5&quot;                &quot;grey6&quot;               
[268] &quot;grey7&quot;                &quot;grey8&quot;                &quot;grey9&quot;               
[271] &quot;grey10&quot;               &quot;grey11&quot;               &quot;grey12&quot;              
[274] &quot;grey13&quot;               &quot;grey14&quot;               &quot;grey15&quot;              
[277] &quot;grey16&quot;               &quot;grey17&quot;               &quot;grey18&quot;              
[280] &quot;grey19&quot;               &quot;grey20&quot;               &quot;grey21&quot;              
[283] &quot;grey22&quot;               &quot;grey23&quot;               &quot;grey24&quot;              
[286] &quot;grey25&quot;               &quot;grey26&quot;               &quot;grey27&quot;              
[289] &quot;grey28&quot;               &quot;grey29&quot;               &quot;grey30&quot;              
[292] &quot;grey31&quot;               &quot;grey32&quot;               &quot;grey33&quot;              
[295] &quot;grey34&quot;               &quot;grey35&quot;               &quot;grey36&quot;              
[298] &quot;grey37&quot;               &quot;grey38&quot;               &quot;grey39&quot;              
[301] &quot;grey40&quot;               &quot;grey41&quot;               &quot;grey42&quot;              
[304] &quot;grey43&quot;               &quot;grey44&quot;               &quot;grey45&quot;              
[307] &quot;grey46&quot;               &quot;grey47&quot;               &quot;grey48&quot;              
[310] &quot;grey49&quot;               &quot;grey50&quot;               &quot;grey51&quot;              
[313] &quot;grey52&quot;               &quot;grey53&quot;               &quot;grey54&quot;              
[316] &quot;grey55&quot;               &quot;grey56&quot;               &quot;grey57&quot;              
[319] &quot;grey58&quot;               &quot;grey59&quot;               &quot;grey60&quot;              
[322] &quot;grey61&quot;               &quot;grey62&quot;               &quot;grey63&quot;              
[325] &quot;grey64&quot;               &quot;grey65&quot;               &quot;grey66&quot;              
[328] &quot;grey67&quot;               &quot;grey68&quot;               &quot;grey69&quot;              
[331] &quot;grey70&quot;               &quot;grey71&quot;               &quot;grey72&quot;              
[334] &quot;grey73&quot;               &quot;grey74&quot;               &quot;grey75&quot;              
[337] &quot;grey76&quot;               &quot;grey77&quot;               &quot;grey78&quot;              
[340] &quot;grey79&quot;               &quot;grey80&quot;               &quot;grey81&quot;              
[343] &quot;grey82&quot;               &quot;grey83&quot;               &quot;grey84&quot;              
[346] &quot;grey85&quot;               &quot;grey86&quot;               &quot;grey87&quot;              
[349] &quot;grey88&quot;               &quot;grey89&quot;               &quot;grey90&quot;              
[352] &quot;grey91&quot;               &quot;grey92&quot;               &quot;grey93&quot;              
[355] &quot;grey94&quot;               &quot;grey95&quot;               &quot;grey96&quot;              
[358] &quot;grey97&quot;               &quot;grey98&quot;               &quot;grey99&quot;              
[361] &quot;grey100&quot;              &quot;honeydew&quot;             &quot;honeydew1&quot;           
[364] &quot;honeydew2&quot;            &quot;honeydew3&quot;            &quot;honeydew4&quot;           
[367] &quot;hotpink&quot;              &quot;hotpink1&quot;             &quot;hotpink2&quot;            
[370] &quot;hotpink3&quot;             &quot;hotpink4&quot;             &quot;indianred&quot;           
[373] &quot;indianred1&quot;           &quot;indianred2&quot;           &quot;indianred3&quot;          
[376] &quot;indianred4&quot;           &quot;ivory&quot;                &quot;ivory1&quot;              
[379] &quot;ivory2&quot;               &quot;ivory3&quot;               &quot;ivory4&quot;              
[382] &quot;khaki&quot;                &quot;khaki1&quot;               &quot;khaki2&quot;              
[385] &quot;khaki3&quot;               &quot;khaki4&quot;               &quot;lavender&quot;            
[388] &quot;lavenderblush&quot;        &quot;lavenderblush1&quot;       &quot;lavenderblush2&quot;      
[391] &quot;lavenderblush3&quot;       &quot;lavenderblush4&quot;       &quot;lawngreen&quot;           
[394] &quot;lemonchiffon&quot;         &quot;lemonchiffon1&quot;        &quot;lemonchiffon2&quot;       
[397] &quot;lemonchiffon3&quot;        &quot;lemonchiffon4&quot;        &quot;lightblue&quot;           
[400] &quot;lightblue1&quot;           &quot;lightblue2&quot;           &quot;lightblue3&quot;          
[403] &quot;lightblue4&quot;           &quot;lightcoral&quot;           &quot;lightcyan&quot;           
[406] &quot;lightcyan1&quot;           &quot;lightcyan2&quot;           &quot;lightcyan3&quot;          
[409] &quot;lightcyan4&quot;           &quot;lightgoldenrod&quot;       &quot;lightgoldenrod1&quot;     
[412] &quot;lightgoldenrod2&quot;      &quot;lightgoldenrod3&quot;      &quot;lightgoldenrod4&quot;     
[415] &quot;lightgoldenrodyellow&quot; &quot;lightgray&quot;            &quot;lightgreen&quot;          
[418] &quot;lightgrey&quot;            &quot;lightpink&quot;            &quot;lightpink1&quot;          
[421] &quot;lightpink2&quot;           &quot;lightpink3&quot;           &quot;lightpink4&quot;          
[424] &quot;lightsalmon&quot;          &quot;lightsalmon1&quot;         &quot;lightsalmon2&quot;        
[427] &quot;lightsalmon3&quot;         &quot;lightsalmon4&quot;         &quot;lightseagreen&quot;       
[430] &quot;lightskyblue&quot;         &quot;lightskyblue1&quot;        &quot;lightskyblue2&quot;       
[433] &quot;lightskyblue3&quot;        &quot;lightskyblue4&quot;        &quot;lightslateblue&quot;      
[436] &quot;lightslategray&quot;       &quot;lightslategrey&quot;       &quot;lightsteelblue&quot;      
[439] &quot;lightsteelblue1&quot;      &quot;lightsteelblue2&quot;      &quot;lightsteelblue3&quot;     
[442] &quot;lightsteelblue4&quot;      &quot;lightyellow&quot;          &quot;lightyellow1&quot;        
[445] &quot;lightyellow2&quot;         &quot;lightyellow3&quot;         &quot;lightyellow4&quot;        
[448] &quot;limegreen&quot;            &quot;linen&quot;                &quot;magenta&quot;             
[451] &quot;magenta1&quot;             &quot;magenta2&quot;             &quot;magenta3&quot;            
[454] &quot;magenta4&quot;             &quot;maroon&quot;               &quot;maroon1&quot;             
[457] &quot;maroon2&quot;              &quot;maroon3&quot;              &quot;maroon4&quot;             
[460] &quot;mediumaquamarine&quot;     &quot;mediumblue&quot;           &quot;mediumorchid&quot;        
[463] &quot;mediumorchid1&quot;        &quot;mediumorchid2&quot;        &quot;mediumorchid3&quot;       
[466] &quot;mediumorchid4&quot;        &quot;mediumpurple&quot;         &quot;mediumpurple1&quot;       
[469] &quot;mediumpurple2&quot;        &quot;mediumpurple3&quot;        &quot;mediumpurple4&quot;       
[472] &quot;mediumseagreen&quot;       &quot;mediumslateblue&quot;      &quot;mediumspringgreen&quot;   
[475] &quot;mediumturquoise&quot;      &quot;mediumvioletred&quot;      &quot;midnightblue&quot;        
[478] &quot;mintcream&quot;            &quot;mistyrose&quot;            &quot;mistyrose1&quot;          
[481] &quot;mistyrose2&quot;           &quot;mistyrose3&quot;           &quot;mistyrose4&quot;          
[484] &quot;moccasin&quot;             &quot;navajowhite&quot;          &quot;navajowhite1&quot;        
[487] &quot;navajowhite2&quot;         &quot;navajowhite3&quot;         &quot;navajowhite4&quot;        
[490] &quot;navy&quot;                 &quot;navyblue&quot;             &quot;oldlace&quot;             
[493] &quot;olivedrab&quot;            &quot;olivedrab1&quot;           &quot;olivedrab2&quot;          
[496] &quot;olivedrab3&quot;           &quot;olivedrab4&quot;           &quot;orange&quot;              
[499] &quot;orange1&quot;              &quot;orange2&quot;              &quot;orange3&quot;             
[502] &quot;orange4&quot;              &quot;orangered&quot;            &quot;orangered1&quot;          
[505] &quot;orangered2&quot;           &quot;orangered3&quot;           &quot;orangered4&quot;          
[508] &quot;orchid&quot;               &quot;orchid1&quot;              &quot;orchid2&quot;             
[511] &quot;orchid3&quot;              &quot;orchid4&quot;              &quot;palegoldenrod&quot;       
[514] &quot;palegreen&quot;            &quot;palegreen1&quot;           &quot;palegreen2&quot;          
[517] &quot;palegreen3&quot;           &quot;palegreen4&quot;           &quot;paleturquoise&quot;       
[520] &quot;paleturquoise1&quot;       &quot;paleturquoise2&quot;       &quot;paleturquoise3&quot;      
[523] &quot;paleturquoise4&quot;       &quot;palevioletred&quot;        &quot;palevioletred1&quot;      
[526] &quot;palevioletred2&quot;       &quot;palevioletred3&quot;       &quot;palevioletred4&quot;      
[529] &quot;papayawhip&quot;           &quot;peachpuff&quot;            &quot;peachpuff1&quot;          
[532] &quot;peachpuff2&quot;           &quot;peachpuff3&quot;           &quot;peachpuff4&quot;          
[535] &quot;peru&quot;                 &quot;pink&quot;                 &quot;pink1&quot;               
[538] &quot;pink2&quot;                &quot;pink3&quot;                &quot;pink4&quot;               
[541] &quot;plum&quot;                 &quot;plum1&quot;                &quot;plum2&quot;               
[544] &quot;plum3&quot;                &quot;plum4&quot;                &quot;powderblue&quot;          
[547] &quot;purple&quot;               &quot;purple1&quot;              &quot;purple2&quot;             
[550] &quot;purple3&quot;              &quot;purple4&quot;              &quot;red&quot;                 
[553] &quot;red1&quot;                 &quot;red2&quot;                 &quot;red3&quot;                
[556] &quot;red4&quot;                 &quot;rosybrown&quot;            &quot;rosybrown1&quot;          
[559] &quot;rosybrown2&quot;           &quot;rosybrown3&quot;           &quot;rosybrown4&quot;          
[562] &quot;royalblue&quot;            &quot;royalblue1&quot;           &quot;royalblue2&quot;          
[565] &quot;royalblue3&quot;           &quot;royalblue4&quot;           &quot;saddlebrown&quot;         
[568] &quot;salmon&quot;               &quot;salmon1&quot;              &quot;salmon2&quot;             
[571] &quot;salmon3&quot;              &quot;salmon4&quot;              &quot;sandybrown&quot;          
[574] &quot;seagreen&quot;             &quot;seagreen1&quot;            &quot;seagreen2&quot;           
[577] &quot;seagreen3&quot;            &quot;seagreen4&quot;            &quot;seashell&quot;            
[580] &quot;seashell1&quot;            &quot;seashell2&quot;            &quot;seashell3&quot;           
[583] &quot;seashell4&quot;            &quot;sienna&quot;               &quot;sienna1&quot;             
[586] &quot;sienna2&quot;              &quot;sienna3&quot;              &quot;sienna4&quot;             
[589] &quot;skyblue&quot;              &quot;skyblue1&quot;             &quot;skyblue2&quot;            
[592] &quot;skyblue3&quot;             &quot;skyblue4&quot;             &quot;slateblue&quot;           
[595] &quot;slateblue1&quot;           &quot;slateblue2&quot;           &quot;slateblue3&quot;          
[598] &quot;slateblue4&quot;           &quot;slategray&quot;            &quot;slategray1&quot;          
[601] &quot;slategray2&quot;           &quot;slategray3&quot;           &quot;slategray4&quot;          
[604] &quot;slategrey&quot;            &quot;snow&quot;                 &quot;snow1&quot;               
[607] &quot;snow2&quot;                &quot;snow3&quot;                &quot;snow4&quot;               
[610] &quot;springgreen&quot;          &quot;springgreen1&quot;         &quot;springgreen2&quot;        
[613] &quot;springgreen3&quot;         &quot;springgreen4&quot;         &quot;steelblue&quot;           
[616] &quot;steelblue1&quot;           &quot;steelblue2&quot;           &quot;steelblue3&quot;          
[619] &quot;steelblue4&quot;           &quot;tan&quot;                  &quot;tan1&quot;                
[622] &quot;tan2&quot;                 &quot;tan3&quot;                 &quot;tan4&quot;                
[625] &quot;thistle&quot;              &quot;thistle1&quot;             &quot;thistle2&quot;            
[628] &quot;thistle3&quot;             &quot;thistle4&quot;             &quot;tomato&quot;              
[631] &quot;tomato1&quot;              &quot;tomato2&quot;              &quot;tomato3&quot;             
[634] &quot;tomato4&quot;              &quot;turquoise&quot;            &quot;turquoise1&quot;          
[637] &quot;turquoise2&quot;           &quot;turquoise3&quot;           &quot;turquoise4&quot;          
[640] &quot;violet&quot;               &quot;violetred&quot;            &quot;violetred1&quot;          
[643] &quot;violetred2&quot;           &quot;violetred3&quot;           &quot;violetred4&quot;          
[646] &quot;wheat&quot;                &quot;wheat1&quot;               &quot;wheat2&quot;              
[649] &quot;wheat3&quot;               &quot;wheat4&quot;               &quot;whitesmoke&quot;          
[652] &quot;yellow&quot;               &quot;yellow1&quot;              &quot;yellow2&quot;             
[655] &quot;yellow3&quot;              &quot;yellow4&quot;              &quot;yellowgreen&quot;         </code></pre>
<p>Pour savoir à quelle couleur correspond chaque nom, le plus simple est probablement de consulter <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">ce document pdf</a> (n’hésitez pas à le sauvegarder si vous pensez en avoir besoin plus tard).</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb153-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb153-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb153-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;mediumorchid2&quot;</span>, <span class="st">&quot;red2&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacetmanual"></span>
<img src="figure/barfacetmanual-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.60: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Outre ces 657 couleurs qui disposent d’un nom spécifique, il est possible de spécifier les couleurs en utilisant des codes hexadécimaux et des codes rgb (red, green, blue). De nombreux sites permettent de choisir n’importe quelle couleur dans une palette qui en compte des millions et d’obtenir de tels code. <a href="https://www.color-hex.com">Ce site</a> permet de le faire très simplement :</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb154-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb154-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports</span><span class="ch">\n</span><span class="st">de New York&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb154-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;#6f71f2&quot;</span>, <span class="st">&quot;#6ff299&quot;</span>, <span class="st">&quot;#f2b86f&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:barfacethex"></span>
<img src="figure/barfacethex-1.png" alt="Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013." width="90%" />
<p class="caption">
Figure 4.61: Nombre de vols par compagnie aérienne au départ des 3 aéroports de New York en 2013.
</p>
</div>
<p>Dernière chose concernant les couleurs : un choix de fonction <code>scale_XXX_XXX()</code> inaproprié est la cause d’erreur la plus fréquente ! Par exemple, si on reprend le code des figures <a href="viz.html#fig:varcolor">4.10</a> et <a href="viz.html#fig:varcolor2">4.11</a> et que l’on modifie les palettes de couleurs, notez que les fonctions utilisées ne sont pas les mêmes :</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay, <span class="dt">color =</span> <span class="kw">factor</span>(month))) <span class="op">+</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb155-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_d</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolorviridis"></span>
<img src="figure/varcolorviridis-1.png" alt="Association de `color` à une variable catégorielle" width="90%" />
<p class="caption">
Figure 4.62: Association de <code>color</code> à une variable catégorielle
</p>
</div>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> alaska_flights, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dep_delay, <span class="dt">y =</span> arr_delay, <span class="dt">color =</span> arr_time)) <span class="op">+</span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_color_viridis_c</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:varcolorviridis2"></span>
<img src="figure/varcolorviridis2-1.png" alt="Association de `color` à une variable numérique" width="90%" />
<p class="caption">
Figure 4.63: Association de <code>color</code> à une variable numérique
</p>
</div>
<p>Pour les 2 figures <a href="viz.html#fig:varcolorviridis">4.62</a> et <a href="viz.html#fig:varcolorviridis2">4.63</a>, j’utilise la palette de couleur <code>viridis</code>. Pour ces 2 graphiques, c’est la couleur des points qui change. Puisque cette couleur est spécifiée avec l’esthétique <code>color</code> et non plus <code>fill</code>, la fonction utilisée est <code>scale_color_XXX()</code> et non plus <code>scale_fill_XXX()</code>.</p>
<p>Enfin, pour la figure <a href="viz.html#fig:varcolorviridis">4.62</a>, c’est une variable catégorielle qui est associée à l’esthétique de couleur (<code>factor(month)</code>). La fonction utilisée pour modifier les couleurs doit donc en tenir compte : le <code>_d</code> à la fin de <code>scale_color_viridis_d()</code> signifie “discrete”, c’est-à-dire “discontinue”. À l’inverse, pour le graphique <a href="viz.html#fig:varcolorviridis2">4.63</a>, c’est une variable numérique continue qui est associée à l’esthétique de couleur (<code>arr_time</code>). La fonction utilisée pour modifier les couleurs en est le reflet : le <code>_c</code> à la fin de <code>scale_color_viridis_c()</code> est l’abbréviation de “continuous”, c’est-à-dire “continue”.</p>
<p>Si vous ne voulez pas avoir de message d’erreur, attention donc, à choisir la fonction <code>scale_XXX_XXX()</code> appropriée. Pour cela, aidez-vous de l’aide que RStudio vous apporte en tapant les premières lettres de la fonction et en parcourant la liste des fonctions proposées dans le menu déroullant qui apparait sous votre curseur.</p>
</div>
<div id="les-themes" class="section level3">
<h3><span class="header-section-number">4.9.3</span> Les thèmes</h3>
<p>L’apparence de tout ce qui ne concerne pas directement les données d’un graphique est sous le contrôle d’un thème. Les thèmes contrôlent l’apparence générale du graphique : quelles polices et tailles de caractères sont utilisées, quel sera l’arrière plan du graphique, faut-il intégrer un quadrillage sous le graphique, et si oui, quelles doivent être ses caractéristiques ?</p>
<p>Il est posible de spécifier chaque élément manuellement. Nous nous contenterons ici de passer en revue quelques thèmes prédéfinis qui devraient couvrir la plupart de vos besoins.</p>
<p>Reprenons par exemple le code de la figure <a href="viz.html#fig:barfacetbrewer">4.58</a> et ajoutons un titre :</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb157-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb157-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports de</span><span class="ch">\n</span><span class="st">New York&quot;</span>,</a>
<a class="sourceLine" id="cb157-7" data-line-number="7">       <span class="dt">title =</span> <span class="st">&quot;Couverture inégale des aéroports de New York par les compagnies aériennes&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb157-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Accent&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:theme1"></span>
<img src="figure/theme1-1.png" alt="Utilisation du thème par défaut : `theme_gray()`." width="90%" />
<p class="caption">
Figure 4.64: Utilisation du thème par défaut : <code>theme_gray()</code>.
</p>
</div>
<p>Le thème utilisé par défaut est <code>theme_gray()</code>. Il est notamment responsable de l’arrière plan gris et du quadrillage blanc. Pour changer de thème, il suffit d’ajouter une couche au graphique en donnant le nom du nouveau thème :</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb158-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb158-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports de</span><span class="ch">\n</span><span class="st">New York&quot;</span>,</a>
<a class="sourceLine" id="cb158-7" data-line-number="7">       <span class="dt">title =</span> <span class="st">&quot;Couverture inégale des aéroports de New York par les compagnies aériennes&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Accent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb158-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:themebw"></span>
<img src="figure/themebw-1.png" alt="Utilisation du thème `theme_bw()`." width="90%" />
<p class="caption">
Figure 4.65: Utilisation du thème <code>theme_bw()</code>.
</p>
</div>
<p>Les thèmes complets que vous pouvez utiliser sont les suivants :</p>
<ul>
<li><code>theme_bw()</code> : fond blanc et quadrillage.</li>
<li><code>theme_calssic()</code> : thème classique, avec des axes mais pas de quadrillage</li>
<li><code>theme_dark()</code> : fond sombre pour augmenter le contraste</li>
<li><code>theme_gray()</code> : thème par défaut : fond gris et quadrillage blanc</li>
<li><code>theme_light()</code> : axes et quadrillages discrets</li>
<li><code>theme_linedraw()</code> : uniquement des lignes noires</li>
<li><code>theme_minimal()</code> : pas d’arrière plan, pas d’axes, quadrillage discret</li>
<li><code>theme_void()</code> : theme vide, seuls les objets géométriques restent visibles</li>
</ul>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb159-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb159-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports de</span><span class="ch">\n</span><span class="st">New York&quot;</span>,</a>
<a class="sourceLine" id="cb159-7" data-line-number="7">       <span class="dt">title =</span> <span class="st">&quot;Couverture inégale des aéroports de New York par les compagnies aériennes&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Accent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_minimal</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:thememinimal"></span>
<img src="figure/thememinimal-1.png" alt="Utilisation du thème minimaliste." width="90%" />
<p class="caption">
Figure 4.66: Utilisation du thème minimaliste.
</p>
</div>
<p>L’argument <code>base_family</code> de chaque thème permet de spécifier une police de caractère différente de celle utilisée par défaut. Évidemment, vous ne pourrez utiliser que des polices qui sont disponibles sur l’ordinateur que vous utilisez. Dans l’exemple de la figure <a href="viz.html#fig:themefont">4.67</a> ci-dessous, j’utilise la police “Futura LT Book”. Si cette police n’est pas disponible sur votre ordinateur, ce code produira une erreur. Si c’est le cas, remplacez-la par une police de votre ordinateur. Attention, son nom exact doit être utilisé. Cela signifie bien sûr le respect des espaces, majuscules, etc.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="kw">ggplot</span>(flights, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_infreq</span>(carrier), <span class="dt">fill =</span> origin)) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>origin, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Compagnie aérienne&quot;</span>,</a>
<a class="sourceLine" id="cb160-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;Nombre de vols&quot;</span>,</a>
<a class="sourceLine" id="cb160-6" data-line-number="6">       <span class="dt">fill =</span> <span class="st">&quot;Aéroports de</span><span class="ch">\n</span><span class="st">New York&quot;</span>,</a>
<a class="sourceLine" id="cb160-7" data-line-number="7">       <span class="dt">title =</span> <span class="st">&quot;Couverture inégale des aéroports de New York par les compagnies aériennes&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Accent&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_family =</span> <span class="st">&quot;Futura LT Book&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:themefont"></span>
<img src="figure/themefont-1.png" alt="Modification de la police de caractère." width="90%" />
<p class="caption">
Figure 4.67: Modification de la police de caractère.
</p>
</div>
<p>Le choix d’un thème et d’une police adaptés doivent vous permettre de faire des graphiques originaux et clairs. Rappelez-vous toujours que vos choix en matière de graphiques doivent avoir pour objectif principal de rendre les tendances plus faciles à décrypter pour un lecteur non familier de vos données. C’est un outil de communication au même titre que n’importe quel paragraphe d’un rapport ou compte-rendu. Et comme pour un paragraphe, la première version d’un graphique est rarement la bonne.</p>
<p>Vous devriez donc maintenant être bien armés pour produire 95% des graphiques dont vous aurez besoin tout au long de votre cursus universitaire. Toutefois, un point important a pour l’instant été omis : l’ajout de barres d’erreurs sur vos graphiques. Nous verrons comment faire cela un peu plus tard, après avoir appris à manipuler efficacement des tableaux de données avec les packages <code>tidyr</code> et <code>dplyr</code>.</p>
<hr />
</div>
</div>
<div id="exercices-6" class="section level2">
<h2><span class="header-section-number">4.10</span> Exercices</h2>
<p>Commencez par créer un nouveau jeu de données en exécutant ces commandes :</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb161-2" data-line-number="2">small_flights &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(arr_delay),</a>
<a class="sourceLine" id="cb161-5" data-line-number="5">         distance <span class="op">&lt;</span><span class="st"> </span><span class="dv">3000</span>)</a></code></pre></div>
<p>Ce nouveau jeu de données de petite taille (972 lignes) est nommé <code>small_flights</code>. Il contient les mêmes variables que le tableau <code>flights</code> mais ne contient qu’une petite fraction de ses lignes. Les lignes retenues ont été choisies au hasard. Vous pouvez visualiser son contenu en tapant son nom dans la console ou en utilisant la fonction <code>View()</code>.</p>
<p>En vous appuyant sur les fonctions et les principes de la grammaire des graphiques que vous avez découverts dans ce chapitre <a href="viz.html#viz">4</a>, et en vous servant de ce nouveau jeu de données, tapez les commandes qui permettent de produire le graphique ci-dessous :</p>
<p><img src="figure/exercice-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Quelques indices :</p>
<ul>
<li>les couleurs utilisées sont celles de la palette <code>Set1</code> du package <code>RColorBrewer</code></li>
<li>les variables utilisées sont <code>origin</code>, <code>air_time</code> et <code>distance</code></li>
<li>la transparence des symboles est fixée à <code>0.8</code></li>
</ul>
<p>Toujours avec ce jeu de données <code>small-flights</code>, tapez les commandes permettant de produire le graphique ci-dessous :</p>
<p><img src="figure/exercice2-1.png" width="90%" style="display: block; margin: auto;" /></p>
<p>Quelques indices :</p>
<ul>
<li>les couleurs utilisées sont celles de la palettes <code>Accent</code> du package <code>RColorBrewer</code></li>
<li>les variables utilisées sont <code>month</code>, <code>carrier</code> et <code>origin</code></li>
</ul>

</div>
</div>
<h3>Références</h3>
<div id="refs" class="references">
<div id="ref-wilkinson2005">
<p>Wilkinson, Leland. 2005. <em>The Grammar of Graphics</em>. 2nd ed. New-York: Springer-Verlag. <a href="https://www.springer.com/us/book/9780387245447" class="uri">https://www.springer.com/us/book/9780387245447</a>.</p>
</div>
<div id="ref-R-ggplot2">
<p>Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, and Kara Woo. 2018. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataset.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
